<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Keep coding">
<meta property="og:type" content="website">
<meta property="og:title" content="Forwards">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Forwards">
<meta property="og:description" content="Keep coding">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Forwards">
<meta name="twitter:description" content="Keep coding">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>Forwards</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
<a href="https://github.com/Ucoon" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Forwards</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">有空的博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/17/软件设计原则和设计模式小记(二)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Forwards">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forwards">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/17/软件设计原则和设计模式小记(二)/" itemprop="url">软件设计原则和设计模式小记（二）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-17T22:38:36+08:00">
                2018-09-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在上篇<a href="http://ucoon.tech/2018/08/07/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99%E5%92%8C%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%B0%8F%E8%AE%B0/" target="_blank" rel="noopener">软件设计原则和设计模式小记（一）</a>中，主要介绍了面向对象的S.O.L.I.D原则和高内聚、低耦合的概念。本文将继续介绍常用的几种设计模式：单例模式、简单工厂模式、策略模式、适配器模式、模板方法模式、装饰者模式以及享元模式。</p>
<h1 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/07/软件设计原则和设计模式小记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Forwards">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forwards">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/07/软件设计原则和设计模式小记/" itemprop="url">软件设计原则和设计模式小记（一）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-07T21:36:44+08:00">
                2018-08-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>从部门老大对于软件设计原则和设计模式的分享，再到近阶段的工作都涉及了软件设计相关的知识，都让我对软件设计这一块难啃的骨头有了小小的认识。本文中的软件设计原则也只简要论述了<strong>面向对象的S.O.L.I.D原则</strong> ，设计模式也只介绍了常用的几种。</p>
<h1 id="面向对象的S-O-L-I-D原则"><a href="#面向对象的S-O-L-I-D原则" class="headerlink" title="面向对象的S.O.L.I.D原则"></a>面向对象的S.O.L.I.D原则</h1><p><strong>SOLID</strong>是五个面向对象编程的重要原则的缩写，它是由Robert C. Martin（Bob大叔）在21世纪初定义的。它是每个开发者必备的基本知识。运用这些原则能让我们写出更优质的代码，能使我们的代码更健壮，更易于维护，有更好的可持续性、扩展性和鲁棒的代码。</p>
<h2 id="高内聚"><a href="#高内聚" class="headerlink" title="高内聚"></a>高内聚</h2><p>内聚：一个模块内各个元素彼此结合的紧密程度；高内聚就是每个模块尽可能独立完成自己的功能，不依赖模块外部的代码。</p>
<h3 id="Single-Responsibility-Principle-SRP-—-单一职责原则"><a href="#Single-Responsibility-Principle-SRP-—-单一职责原则" class="headerlink" title="Single Responsibility Principle(SRP) — 单一职责原则"></a>Single Responsibility Principle(SRP) — 单一职责原则</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><blockquote>
<p>一个类或者模块应该有且只有一个改变的原因</p>
</blockquote>
<p>职责单一原则的核心思想是：一个类或模块只负责一个功能，并且只有一个引起它变化的原因。单一职责原则可以看作是低耦合，高内聚在面向对象的引申，将职责定义为引起变化的原因，以提高内聚性来减少引起变化的原因。 职责越多，可能引起它变化的原因就越多，也将导致职责依赖严重，从而使耦合度增大。</p>
<h4 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h4><p>首先我们先看一个用户信息类（UserInfo）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserInfo</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">getPassword</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addUser</span><span class="params">(UserInfo user)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码将业务对象和业务逻辑的内容放到了一个类中，业务对象和业务逻辑都会引起IUserInfo类的变化，上面的代码就违反了单一职责原则。按照SRP原则，我们应该<strong>为不同的职责创建不同的类</strong>，修改如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserBro</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">getPassword</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserBiz</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addUser</span><span class="params">(UserInfo user)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，我们就有了两个类，但是<strong>每个类都有单一的职责</strong>，我们使它变成了低耦合高内聚。</p>
<h4 id="好处"><a href="#好处" class="headerlink" title="好处"></a>好处</h4><ul>
<li>降低耦合性</li>
<li>代码易于理解和维护</li>
</ul>
<h3 id="Interface-Segregation-Principle-ISP-—-接口隔离原则"><a href="#Interface-Segregation-Principle-ISP-—-接口隔离原则" class="headerlink" title="Interface Segregation Principle(ISP) — 接口隔离原则"></a>Interface Segregation Principle(ISP) — 接口隔离原则</h3><h4 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h4><blockquote>
<p>使用多个专用的接口比使用一个通用接口好</p>
</blockquote>
<p>ISP原则意思是把功能实现在接口中，而不是类中；并且一个类绝不要实现不会用到的接口。不遵循这个原则意味着我们在实现里会依赖很多我们并不需要的方法，但又不得不去定义。所以，实现多个特定的接口比实现一个通用接口要好。一个接口被需要用到的类所定义，所以这个接口不应该有这个类不需要实现的其他方法。</p>
<h4 id="代码示例-1"><a href="#代码示例-1" class="headerlink" title="代码示例"></a>代码示例</h4><p>我们有一个ICar的接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICar</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">startEngine</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accelerate</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时也有一个实现ICar接口的Mustang类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mustang</span> <span class="keyword">implements</span> <span class="title">ICar</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//start engine...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accelerate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//accelerate...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在要添加一个新的车型：一辆DeloRean，可以穿梭时空。</p>
<p>我们修改ICar接口类以满足此需求：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICar</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">startEngine</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accelerate</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">backToThePast</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">backToTheFuture</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>新增DeloRean类实现ICar接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeloRean</span> <span class="keyword">implements</span> <span class="title">ICar</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//start engine...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accelerate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//accelerate...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">backToThePast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//back to the past...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">backToTheFuture</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//back to the future...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时修改Mustang类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mustang</span> <span class="keyword">implements</span> <span class="title">ICar</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//start engine...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accelerate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//accelerate...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">backToThePast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//Mustang没有穿梭时空的能力</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">backToTheFuture</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//Mustang没有穿梭时空的能力</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种情况下，Mustang违反了接口隔离原则，它实现了它不需要的方法。</p>
<p><strong>使用接口隔离的解决方法：</strong></p>
<p>重构ICar接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICar</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">startEngine</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accelerate</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>新增ITimeMachine接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ITimeMachine</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">backToThePast</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">backToTheFuture</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构Mustang（只实现ICar接口）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mustang</span> <span class="keyword">implements</span> <span class="title">ICar</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//start engine...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accelerate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//accelerate...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构DeloRean（同时实现ICar和ITimeMachine）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeloRean</span> <span class="keyword">implements</span> <span class="title">ICar</span>, <span class="title">ITimeMachine</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//start engine...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accelerate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//accelerate...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">backToThePast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//back to the past...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">backToTheFuture</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//back to the future...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="好处-1"><a href="#好处-1" class="headerlink" title="好处"></a>好处</h4><ul>
<li>系统解耦</li>
<li>代码易于重构</li>
</ul>
<h2 id="低耦合"><a href="#低耦合" class="headerlink" title="低耦合"></a>低耦合</h2><p>耦合：模块与模块之间接口的复杂程度，模块之间联系越复杂耦合度越高，牵一发动全身；低耦合就是要尽可能减少模块之间的交互复杂程度。</p>
<h3 id="Open-Closed-Principle-OCP-—-开闭原则"><a href="#Open-Closed-Principle-OCP-—-开闭原则" class="headerlink" title="Open/Closed Principle(OCP) — 开闭原则"></a>Open/Closed Principle(OCP) — 开闭原则</h3><h4 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h4><blockquote>
<p>软件中的对象（类、模块、函数等等）应该对于扩展是开放的，但是对于修改是封闭的</p>
</blockquote>
<p>根据这一原则，一个实体是允许在不改变它的源代码的前提下变更它的行为。</p>
<ul>
<li><strong>open for extension</strong>：对扩展开放，意味着有新的需求或变化时，可以对现有代码进行扩展，以适应新的情况。</li>
<li><strong>close for modification</strong>：对修改封闭，意味着扩展新的功能行为而不需要也不应该修改现有的代码。</li>
</ul>
<p>对于面向对象来说，需要你依赖抽象，而不是实现。</p>
<h4 id="代码示例-2"><a href="#代码示例-2" class="headerlink" title="代码示例"></a>代码示例</h4><p>首先我们有两个不同形状的类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> width;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> height;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//getter and setter methods...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Square</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> side;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//getter and setter methods...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其次我们还有一个类可以画出不同的形状：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapePrinter</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawShape</span><span class="params">(Object shape)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(shape <span class="keyword">instanceof</span> Rectangle)&#123;</span><br><span class="line">            <span class="comment">//Draw Rectangle...</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(shape <span class="keyword">instanceof</span> Square)&#123;</span><br><span class="line">            <span class="comment">//Draw Square...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从上面可以看到，当我们每次想画一个新的形状就要<strong>修改ShapePrinter类的drawShape方法来接受这个新的形状</strong>。这样当形状种类多了之后，ShapePrinter类就会存在大量的<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">按照OCP原则，修改如下：</span><br><span class="line"></span><br><span class="line">我们添加一个Shape接口类：</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">public interface Shape&#123;</span><br><span class="line">    void draw();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>重构Rectangle类和Square类以实现Shape：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> width;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> height;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//getter and setter methods...</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//Draw Rectangle...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">implements</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> side;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//getter and setter methods...</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//Draw Square...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ShapePrinter类的重构：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawShape</span><span class="params">(Shape shape)</span></span>&#123;</span><br><span class="line">        shape.draw();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="好处-2"><a href="#好处-2" class="headerlink" title="好处"></a>好处</h4><ul>
<li>代码的可维护性和复用性</li>
<li>代码会更健壮 </li>
</ul>
<h3 id="Liskov-Substitution-Principle-LSP-—-里氏替换原则"><a href="#Liskov-Substitution-Principle-LSP-—-里氏替换原则" class="headerlink" title="Liskov Substitution Principle(LSP) — 里氏替换原则"></a>Liskov Substitution Principle(LSP) — 里氏替换原则</h3><h4 id="定义-3"><a href="#定义-3" class="headerlink" title="定义"></a>定义</h4><blockquote>
<p>派生类（子类）对象可以在程式中代替其基类（超类）对象。“Subtypes must be substituable for their base types”</p>
</blockquote>
<p>根据定义所说，程序里的对象都应该可以被它的子类实例替换而不用更改程序，另外不应该在代码中出现if/else之类对子类类型进行判断的条件。里氏替换原则是使代码符合开闭原则的一个重要保证。正是由于子类的可替换性才使得父类型的模块在无需修改的情况下就可以扩展。</p>
<h4 id="代码示例-3"><a href="#代码示例-3" class="headerlink" title="代码示例"></a>代码示例</h4><p>我们有一个Rectangle类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> width;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> height;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHeight</span><span class="params">(<span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWidth</span><span class="params">(<span class="keyword">int</span> width)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getArea</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> width*height;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还有一个Square类（从数学上讲正方形也是长方形的一种）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHeight</span><span class="params">(<span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setWidth(height);</span><br><span class="line">        <span class="keyword">super</span>.setHeight(height);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWidth</span><span class="params">(<span class="keyword">int</span> width)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setWidth(width);</span><br><span class="line">        <span class="keyword">super</span>.setHeight(width);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们写个测试函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LiskovSubstitutionTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">        Rectangle rectangle = <span class="keyword">new</span> Rectangle();</span><br><span class="line">        rectangle.setWidth(<span class="number">2</span>);</span><br><span class="line">        rectangle.setHeight(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (rectangle.getArea() == <span class="number">10</span>)&#123;</span><br><span class="line">         System.out.println(rectangle.getArea());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样的函数却不适用Square：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LiskovSubstitutionTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">        Rectangle rectangle = <span class="keyword">new</span> Square();</span><br><span class="line">        rectangle.setWidth(<span class="number">2</span>);</span><br><span class="line">        rectangle.setHeight(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (rectangle.getArea() == <span class="number">10</span>)&#123;</span><br><span class="line">         System.out.println(rectangle.getArea());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从代码上看出Square并不能正确替代Rectangle类，因为它不遵循Rectangle的行为规则，违反了LSP原则。</p>
<p>解决方法：</p>
<p>用IShape接口来获取面积：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IShape</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">area</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构Rectangle和Square以实现IShape：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">implements</span> <span class="title">IShape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> width;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> height;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHeight</span><span class="params">(<span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWidth</span><span class="params">(<span class="keyword">int</span> width)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">area</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> width*height;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LiskovSubstitutionTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">        IShape shape = <span class="keyword">new</span> Square();</span><br><span class="line">        shape.setWidth(<span class="number">2</span>);</span><br><span class="line">        shape.setHeight(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (shape.getArea() == <span class="number">10</span>)&#123;</span><br><span class="line">         System.out.println(shape.getArea());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="好处-3"><a href="#好处-3" class="headerlink" title="好处"></a>好处</h4><ul>
<li>更高的代码复用性</li>
<li>类的层次结构易于理解</li>
</ul>
<h3 id="Dependency-Inversion-Principle-DIP-—-依赖倒置原则"><a href="#Dependency-Inversion-Principle-DIP-—-依赖倒置原则" class="headerlink" title="Dependency Inversion Principle(DIP) — 依赖倒置原则"></a>Dependency Inversion Principle(DIP) — 依赖倒置原则</h3><h4 id="定义-4"><a href="#定义-4" class="headerlink" title="定义"></a>定义</h4><blockquote>
<p>高层次的模块不应该依赖于低层次的模块，两者都应该依赖于抽象接口</p>
<p>抽象接口不应该依赖于具体实现，而具体实现则应该依赖于抽象接口</p>
</blockquote>
<p>在面向对象编程领域中，依赖反转原则是指一个特定的类不应该直接依赖于另一个类，但是可以依赖于这个类的抽象（接口）。</p>
<p>附上来自维基百科上的图：</p>
<img src="http://pcmve13p6.bkt.clouddn.com/static/images/Dependency_inversion.jpg">
<p>图1中，高层对象A依赖于底层对象B的实现；图2中，把高层对象A对底层对象的需求抽象为一个接口A，底层对象B实现了接口A，这就是依赖反转。 </p>
<h4 id="代码示例-4"><a href="#代码示例-4" class="headerlink" title="代码示例"></a>代码示例</h4><p>我们有个DeliveryDriver类代表着一个司机为快递公司工作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeliveryDriver</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deliveryProduct</span><span class="params">(Product product)</span></span>&#123;</span><br><span class="line">        <span class="comment">//运送产品</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其次有个DeliveryCompany类处理货物装运：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeliveryCompany</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendProduct</span><span class="params">(Product product)</span></span>&#123;</span><br><span class="line">        DeliveryDriver deliveryDriver = <span class="keyword">new</span> DeliveryDriver();</span><br><span class="line">        deliveryDriver.deliveryProduct(product);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上述代码中，DeliveryCompany创建并使用DeliveryDriver实例，所以DeliveryCompany是一个依赖于低层次类的高层次的类，这就违反了依赖反转原则（在上述代码中DeliveryCompany需要运送货物，必须需要一个DeliveryDriver参与，但如果以后对DeliveryDriver有更多的要求，那我们既要修改DeliveryDriver也要修改上述代码，这样造成的依赖，耦合度高。）</p>
<p>解决方法：</p>
<p>创建DeliveryService接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DeliveryService</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deliveryProduct</span><span class="params">(Product product)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构DeliveryDriver类以实现DeliveryService接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeliveryDriver</span> <span class="keyword">implements</span> <span class="title">DeliveryService</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deliveryProduct</span><span class="params">(Product product)</span></span>&#123;</span><br><span class="line">        <span class="comment">//运送产品</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构DeliveryCompany类，使它依赖于一个抽象而不是一个具体的类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeliveryCompany</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> DeliveryService deliveryService;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DeliveryCompany</span><span class="params">(DeliveryService deliveryService)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.deliveryService = deliveryService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendProduct</span><span class="params">(Product product)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.deliveryService.deliveryProduct(product);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="好处-4"><a href="#好处-4" class="headerlink" title="好处"></a>好处</h4><ul>
<li>减少耦合</li>
<li>代码更高的复用性</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/23/看懂UML时序图和类图/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Forwards">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forwards">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/23/看懂UML时序图和类图/" itemprop="url">看懂UML时序图和类图</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-23T20:58:05+08:00">
                2018-07-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近在工作中第一次接触UML相关内容，本篇为学习笔记，写得不好，还请大神们多多指教。以下是本篇文章的大体结构。</p>
<p><img src="http://sdssdccddd.gitee.io/myblogimg/看懂UML时序图和类图.png" alt="看懂UML时序图和类图"></p>
<h2 id="UML"><a href="#UML" class="headerlink" title="UML"></a>UML</h2><h3 id="1-定义"><a href="#1-定义" class="headerlink" title="1. 定义"></a>1. 定义</h3><p>以下定义引自维基百科：</p>
<blockquote>
<p>统一建模语言（Unified Modeling Language，缩写UML）是非专利的第三代建模和规约语言。UML是一种开放的方法，用于说明、可视化、构建和编写一个正在开发的、面向对象的、软件密集系统的制品的开放方法。</p>
</blockquote>
<h3 id="2-模型"><a href="#2-模型" class="headerlink" title="2. 模型"></a>2. 模型</h3><p>UML中的三个主要模型：</p>
<ol>
<li>功能模型：从用户的角度展示系统的功能，包括用例图</li>
<li>对象模型：采用对象、属性、操作、关联等概念展示系统的结构和基础，包括类别图、对象图</li>
<li>动态模型：展示系统的内部行为，包括序列图（时序图）、活动图和状态图。</li>
</ol>
<h3 id="3-图形"><a href="#3-图形" class="headerlink" title="3. 图形"></a>3. 图形</h3><p>在UML 2.2中一共定义了14种图示。这里只介绍序列图和类图。</p>
<h2 id="序列图"><a href="#序列图" class="headerlink" title="序列图"></a>序列图</h2><h3 id="1-定义-1"><a href="#1-定义-1" class="headerlink" title="1. 定义"></a>1. 定义</h3><p>序列图（Sequence Diagram），也叫做循序图，是一种UML行为图。大多数人翻译为时序图（维基百科上称这种叫法并不准确），UML规范中对Sequence Diagram是这么解释的：</p>
<blockquote>
<p>A sequence diagram describes an Interaction by focusing on the sequence of Messages that are exchanged, along with their corresponding Occurrence Specifications on the Lifelines</p>
</blockquote>
<p>事实上，序列图与我们中学时代学的流程图大同小异，它描述的是消息在生命线上按照约定顺序执行一种交互行为。它是属于一种动态模型。</p>
<h3 id="2-元素"><a href="#2-元素" class="headerlink" title="2. 元素"></a>2. 元素</h3><ol>
<li>对象（Object）</li>
<li>生命线（Lifeline）</li>
<li>消息（Message）</li>
<li>激活（Activation）</li>
</ol>
<h3 id="3-示例图"><a href="#3-示例图" class="headerlink" title="3. 示例图"></a>3. 示例图</h3><p><img src="http://sdssdccddd.gitee.io/myblogimg/时序图示例.jpg" alt="时序图示例"></p>
<h2 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h2><h3 id="1-定义-2"><a href="#1-定义-2" class="headerlink" title="1.定义"></a>1.定义</h3><p>类图是统一建模语言中一种对象模型，这种图描述的是系统的类集合，类的属性和类之间的关系。</p>
<h3 id="2-元素-1"><a href="#2-元素-1" class="headerlink" title="2. 元素"></a>2. 元素</h3><p><img src="http://sdssdccddd.gitee.io/myblogimg/类图示例.jpg" alt="类图示例"></p>
<p>上图是类图的示例，一个类有三个区域，最上面的是类名称，中间部分是类的属性，底部是类的方法。</p>
<p>UML提供机制，以代表类的成员，如属性和方法。指定一个类成员（即任何属性和方法）的可见性有下列符号：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">public</span> 公有</span><br><span class="line">- <span class="keyword">private</span> 私有</span><br><span class="line"># protected 保护</span><br><span class="line">~ 包（即对包内其他成员可见）</span><br><span class="line">/ 推导（即由其他属性推导得出，不需要直接给定其值）</span><br></pre></td></tr></table></figure>
<h3 id="3-类图中的关系"><a href="#3-类图中的关系" class="headerlink" title="3. 类图中的关系"></a>3. 类图中的关系</h3><ol>
<li>泛化（Generalization）</li>
</ol>
<p>即继承(extend)的反方向。在UML类图中用带空心三角形的直线表示。如下图所示：</p>
<p><img src="http://sdssdccddd.gitee.io/myblogimg/Generalization.jpg" alt="Generalization"></p>
<ol start="2">
<li>实现（Realization）</li>
</ol>
<p>即对应implements关键字。用带空心三角形的虚线表示</p>
<p><img src="http://sdssdccddd.gitee.io/myblogimg/Realization.jpg" alt="Realization"></p>
<ol start="3">
<li>依赖（Dependency）</li>
</ol>
<p>依赖关系可以理解为一个类A使用到了另一个类B，被依赖的对象只是作为一种工具在使用，<strong>而并不持有对它的引用。</strong> </p>
<blockquote>
<p>这种使用关系是具有偶然性、临时性的、非常弱的 </p>
</blockquote>
<p>但是B类的变化会影响到类A，表现在代码层面：类B作为参数被类A在某个方法中使用。用带燕尾箭头的虚线表示。</p>
<p><img src="http://sdssdccddd.gitee.io/myblogimg/Dependency.jpg" alt="Dependency"></p>
<ol start="4">
<li>聚合（Aggregate）</li>
</ol>
<p>聚合是表示整体与部分的一类特殊的关联关系，是弱的包含关系，成分类可以不依靠聚合类而单独存在，可以具有各自的生命周期，部分可以属于多个整体，也可以为多个整体对象共享。用以带空心的菱形剪尾的实线表示。</p>
<p><img src="http://sdssdccddd.gitee.io/myblogimg/Aggregation.jpg" alt="Aggregation"></p>
<ol start="5">
<li>组合（Composition）</li>
</ol>
<p>组合是一类强的整体与部分的包含关系。成分类必须依靠合成类而存在，整体与部分是不可分的（这是与聚合关系最大的区别），整体的生命周期结束也就意味着部分的生命周期结束。图形中用带实心的菱形剪尾的实线表示。</p>
<p><img src="http://sdssdccddd.gitee.io/myblogimg/Composition.jpg" alt="Composition"></p>
<ol start="6">
<li>关联（Association）</li>
</ol>
<p>关联是两个类之间，或类与接口之间一种强依赖关系，是一种长期的稳定关系。关联关系又分为单向关联、双向关联和自关联。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/27/魅族Android7-0-Settings源码分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Forwards">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forwards">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/27/魅族Android7-0-Settings源码分析/" itemprop="url">魅族Android7-0-Settings源码分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-27T23:43:16+08:00">
                2018-05-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="魅族Android7-0-Settings源码分析"><a href="#魅族Android7-0-Settings源码分析" class="headerlink" title="魅族Android7-0-Settings源码分析"></a>魅族Android7-0-Settings源码分析</h1><p><strong>前言</strong>：</p>
<p>只能说对魅族手机系统很是无奈啊！！！为了分析魅族手机无法通过常见的方法跳到系统设置的无障碍服务，只好通过<strong>豌豆荚将settings.apk导出</strong>然后进行反编译，跟踪源码…….</p>
<h2 id="准备工作（反编译apk以及AndroidManifest-xml文件）"><a href="#准备工作（反编译apk以及AndroidManifest-xml文件）" class="headerlink" title="准备工作（反编译apk以及AndroidManifest.xml文件）"></a>准备工作（反编译apk以及AndroidManifest.xml文件）</h2><ol>
<li>从反编译一开始就碰上了坑，利用dex2jar-2.0无法导出classes-dex2jar.jar文件，原因暂未找到，解决方案是将classes.dex用nodepad++打开，将037，改成036，保存，再用dex2jar。</li>
</ol>
<blockquote>
<p>参考链接：<a href="https://www.jianshu.com/p/55bf5f688e9a" target="_blank" rel="noopener">https://www.jianshu.com/p/55bf5f688e9a</a></p>
</blockquote>
<ol start="2">
<li>反编译AndroidManifest.xml文件可请教谷歌</li>
</ol>
<h2 id="Settings应用的启动类"><a href="#Settings应用的启动类" class="headerlink" title="Settings应用的启动类"></a>Settings应用的启动类</h2><p>首先跟踪Settings的启动类，查看package/app/Settings/AndroidManifest.xml文件</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity-alias android:label=<span class="string">"@string/settings_label_launcher"</span> android:launchMode=<span class="string">"singleTask"</span> android:name=<span class="string">"com.android.settings.Settings"</span> android:targetActivity=<span class="string">"com.android.settings.Settings"</span> android:taskAffinity=<span class="string">"com.android.settings"</span>&gt;</span><br><span class="line">     &lt;intent-filter&gt;</span><br><span class="line">         &lt;action android:name=<span class="string">"android.intent.action.MAIN"</span>/&gt;</span><br><span class="line">         &lt;category android:name=<span class="string">"android.intent.category.DEFAULT"</span>/&gt;</span><br><span class="line">         &lt;category android:name=<span class="string">"android.intent.category.LAUNCHER"</span>/&gt;</span><br><span class="line">     &lt;/intent-filter&gt;</span><br><span class="line"> &lt;/activity-alias&gt;</span><br></pre></td></tr></table></figure>
<p><em>第一次遇到<activity-alias>标签，一脸懵逼o((⊙﹏⊙))o，查了才知道是作为一个已存在Activity的别名，可用来设置某个Activity的快捷入口。举例：某个Activity需要进入应用的主界面才能够点击进入，如果使用了该标签，甚至可以在桌面生成一个该Activity的图标，然后点击桌面图标直接进入该Activity。</activity-alias></em><br>从AndroidManifest.xml可以看到，Settings的启动类为Settings.java，源码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Settings</span> <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AccessibilityDaltonizerSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AccessibilitySettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountSyncSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AdvancedAppsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AdvancedWifiSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AllApplicationsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AndroidBeamSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ApnEditorActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ApnSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AppDrawOverlaySettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AppMemoryUsageActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AppNotificationSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AppWriteSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AvailableVirtualKeyboardActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BackgroundCheckSummaryActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BatterySaverSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BluetoothSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CaptioningSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ChooseAccountActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigureNotificationSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CryptKeeperSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DataUsageSummaryActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DateTimeSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DevelopmentSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DeviceAdminSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DeviceInfoSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DeviceSettings</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DisplaySettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DomainsURLsAppListActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DreamSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FingerprintEnrollSuggestionActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">FingerprintEnrollIntroduction</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FingerprintSuggestionActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">FingerprintSettings</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HighPowerApplicationsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">IccLockSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ImeiInformationActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InputMethodAndLanguageSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">KeyboardLayoutPickerActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalePickerActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LocationSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ManageApplicationsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ManageAssistActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MemorySettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">NotificationAccessSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">NotificationAppListActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">NotificationStationActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">NotificationStatusbarSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">OtherSoundSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">OverlaySettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonalSettings</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PhysicalKeyboardActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PowerUsageSummaryActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PrintJobSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PrintSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PrivacySettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PrivateVolumeForgetActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PrivateVolumeSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PublicVolumeSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RunningServicesActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SavedAccessPointsSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ScreenLockSuggestionActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">ChooseLockGeneric</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SecuritySettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SimSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SimStatusActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SoundSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SpellCheckersSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">StatusActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">StorageSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">StorageUseActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SystemSettings</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TestingSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TetherSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TextToSpeechSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TopLevelSettings</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TrustedCredentialsSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">UsageAccessSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDictionarySettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">UserSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">VpnSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">VrListenersSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WallpaperSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WallpaperSuggestionActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WifiAPITestActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WifiCallingSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WifiCallingSuggestionActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WifiDisplaySettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WifiInfoActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WifiP2pSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WifiSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WirelessSettings</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WirelessSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WriteSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ZenAccessSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ZenModeAutomationSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ZenModeAutomationSuggestionActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ZenModeEventRuleSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ZenModeExternalRuleSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ZenModePrioritySettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ZenModeScheduleRuleSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ZenModeSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ZenModeVisualInterruptionSettingsActivity</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class">  </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Settings.java定义了大量静态内部类，没有任何跟界面UI相关的内容。这时候我就很困惑了，跳转到无障碍服务设置界面的内部实现是什么样的，不过从源码上看应该是AccessibilitySettingsActivity这个类，其继承自SettingsActivity类，所以继续跟踪。</p>
<h2 id="SettingsActivity"><a href="#SettingsActivity" class="headerlink" title="SettingsActivity"></a>SettingsActivity</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SettingsActivity</span> <span class="keyword">extends</span> <span class="title">SettingsDrawerActivity</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">PreferenceManager</span>.<span class="title">OnPreferenceTreeClickListener</span>, <span class="title">PreferenceFragment</span>.<span class="title">OnPreferenceStartFragmentCallback</span>, <span class="title">ButtonBarHandler</span>, <span class="title">FragmentManager</span>.<span class="title">OnBackStackChangedListener</span>, <span class="title">SearchView</span>.<span class="title">OnQueryTextListener</span>, <span class="title">SearchView</span>.<span class="title">OnCloseListener</span>, <span class="title">MenuItemCompat</span>.<span class="title">OnActionExpandListener</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br></pre></td></tr></table></figure>
<p>SettingsDrawerActivity类最终继承自Activity，所以我们应该从onCreate()入手。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle paramBundle)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(paramBundle);</span><br><span class="line">    System.currentTimeMillis();</span><br><span class="line">    Object localObject = Settings.Secure.getUriFor(<span class="string">"mz_current_power_mode"</span>);</span><br><span class="line">    getContentResolver().registerContentObserver((Uri)localObject, <span class="keyword">false</span>, <span class="keyword">this</span>.mPowerSaveObserver, -<span class="number">1</span>);</span><br><span class="line"><span class="comment">// Should happen before any call to getIntent()</span></span><br><span class="line">    getMetaData();</span><br><span class="line">    localObject = getIntent();</span><br></pre></td></tr></table></figure></p>
<p>这里有个获取MetaData的方法，我们看一下这个方法的具体实现，同时我们从注释还可以看到这个方法需要在调用getIntent()之前进行调用。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getMetaData</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    ActivityInfo localActivityInfo = getPackageManager().getActivityInfo(getComponentName(), PackageManager.GET_META_DATA);</span><br><span class="line">    <span class="keyword">if</span> (localActivityInfo != <span class="keyword">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (localActivityInfo.metaData == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.mFragmentClass = localActivityInfo.metaData.getString(<span class="string">"com.android.settings.FRAGMENT_CLASS"</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (PackageManager.NameNotFoundException localNameNotFoundException)</span><br><span class="line">  &#123;</span><br><span class="line">    Log.d(<span class="string">"Settings"</span>, <span class="string">"Cannot get Metadata for: "</span> + getComponentName().toString());</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个函数的作用就是从Activity标签中获取meta-data中key为<figure class="highlight plain"><figcaption><span>。所以我们应该再去AndroidManifest.xml查看AccessibilitySettingsActivity相关内容，具体如下：</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">```java</span><br><span class="line">        &lt;activity android:configChanges=&quot;keyboardHidden|orientation|screenSize&quot; android:icon=&quot;@drawable/mz_function_list_ic_accessibility&quot; android:label=&quot;@string/accessibility_settings&quot; android:name=&quot;com.android.settings.Settings$AccessibilitySettingsActivity&quot; android:taskAffinity=&quot;&quot;&gt;</span><br><span class="line">            &lt;intent-filter android:priority=&quot;1&quot;&gt;</span><br><span class="line">                &lt;action android:name=&quot;android.settings.ACCESSIBILITY_SETTINGS&quot;/&gt;</span><br><span class="line">                &lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=&quot;android.intent.action.VIEW&quot;/&gt;</span><br><span class="line">                &lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;</span><br><span class="line">                &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot;/&gt;</span><br><span class="line">                &lt;data android:host=&quot;com.android.settings&quot; android:path=&quot;/accessibility_settings&quot; android:scheme=&quot;flyme_3dtouch&quot;/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=&quot;android.intent.action.MAIN&quot;/&gt;</span><br><span class="line">                &lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;</span><br><span class="line">                &lt;category android:name=&quot;android.intent.category.VOICE_LAUNCH&quot;/&gt;</span><br><span class="line">                &lt;category android:name=&quot;com.android.settings.SHORTCUT&quot;/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">            &lt;intent-filter android:priority=&quot;3&quot;&gt;</span><br><span class="line">                &lt;action android:name=&quot;com.android.settings.action.SETTINGS&quot;/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">            &lt;meta-data android:name=&quot;com.android.settings.category&quot; android:value=&quot;com.android.settings.category.system&quot;/&gt;</span><br><span class="line">            &lt;meta-data android:name=&quot;com.android.settings.FRAGMENT_CLASS&quot; android:value=&quot;com.meizu.settings.accessibility.FlymeAccessibilitySettings&quot;/&gt;</span><br><span class="line">            &lt;meta-data android:name=&quot;com.android.settings.PRIMARY_PROFILE_CONTROLLED&quot; android:value=&quot;true&quot;/&gt;</span><br><span class="line">            &lt;meta-data android:name=&quot;usagestats.event&quot; android:value=&quot;accessibility_settings-click&quot;/&gt;</span><br><span class="line">        &lt;/activity&gt;</span><br></pre></td></tr></table></figure></p>
<p>从上面可以看出mFragmentClass  = “com.meizu.settings.accessibility.FlymeAccessibilitySettings”。<br>找到了Fragment，就要看看它是怎么加载Fragment的，继续看onCreate函数，接下来就跟踪到了getIntent()方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Intent <span class="title">getIntent</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Intent localIntent1 = <span class="keyword">super</span>.getIntent();</span><br><span class="line">  Object localObject = getStartingFragmentClass(localIntent1);</span><br><span class="line">  <span class="keyword">if</span> (localObject != <span class="keyword">null</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    Intent localIntent2 = <span class="keyword">new</span> Intent(localIntent1);</span><br><span class="line">    localIntent2.putExtra(<span class="string">":settings:show_fragment"</span>, (String)localObject);</span><br><span class="line">    localObject = localIntent1.getExtras();</span><br><span class="line">    <span class="keyword">if</span> (localObject != <span class="keyword">null</span>) &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> (localObject = <span class="keyword">new</span> Bundle((Bundle)localObject);; localObject = <span class="keyword">new</span> Bundle())</span><br><span class="line">    &#123;</span><br><span class="line">      ((Bundle)localObject).putParcelable(<span class="string">"intent"</span>, localIntent1);</span><br><span class="line">      localIntent2.putExtra(<span class="string">":settings:show_fragment_args"</span>, (Bundle)localObject);</span><br><span class="line">      <span class="keyword">return</span> localIntent2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> localIntent1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getStartingFragmentClass</span><span class="params">(Intent paramIntent)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.mFragmentClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.mFragmentClass;</span><br><span class="line">  &#125;</span><br><span class="line">  String str = paramIntent.getComponent().getClassName();</span><br><span class="line">  <span class="keyword">if</span> (str.equals(getClass().getName())) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ((!<span class="string">"com.android.settings.ManageApplications"</span>.equals(str)) &amp;&amp; (!<span class="string">"com.android.settings.RunningServices"</span>.equals(str)))</span><br><span class="line">  &#123;</span><br><span class="line">    paramIntent = str;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="string">"com.android.settings.applications.StorageUse"</span>.equals(str)) &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    paramIntent = ManageApplications.class.getName();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> paramIntent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>从源码可以看出getIntent()就是返回了一个Intent，并传了一个参数（key为<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">分析了getIntent，继续往下看onCreate函数，看这个intent是如何使用的。</span><br><span class="line">```java</span><br><span class="line">      if (!this.mIsShowingDashboard)</span><br><span class="line">      &#123;</span><br><span class="line">        this.mDisplaySearch = false;</span><br><span class="line">        if (this.mIsShortcut) &#123;</span><br><span class="line">          this.mDisplayHomeAsUpEnabled = bool;</span><br><span class="line">        &#125;</span><br><span class="line">        for (;;)</span><br><span class="line">        &#123;</span><br><span class="line">          setTitleFromIntent((Intent)localObject);</span><br><span class="line">          switchToFragment(str1, ((Intent)localObject).getBundleExtra(&quot;:settings:show_fragment_args&quot;), true, false, this.mInitialTitleResId, this.mInitialTitle, false);</span><br><span class="line">          break;</span><br><span class="line">          if (bool)</span><br><span class="line">          &#123;</span><br><span class="line">            this.mDisplayHomeAsUpEnabled = true;</span><br><span class="line">            this.mDisplaySearch = false;</span><br><span class="line">          &#125;</span><br><span class="line">          else</span><br><span class="line">          &#123;</span><br><span class="line">            this.mDisplayHomeAsUpEnabled = true;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure></p>
<p>从上面源码大概能看出关键部分应该是switchToFragment()函数。我们再看一下switchToFragment的实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Fragment <span class="title">switchToFragment</span><span class="params">(String paramString, Bundle paramBundle, <span class="keyword">boolean</span> paramBoolean1, <span class="keyword">boolean</span> paramBoolean2, <span class="keyword">int</span> paramInt, CharSequence paramCharSequence, <span class="keyword">boolean</span> paramBoolean3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (FlymeDashboardSummary.isConnectivitySettingsFragment(paramString))</span><br><span class="line">  &#123;</span><br><span class="line">    FlymeDashboardSummary.startWithFragment(<span class="keyword">this</span>, paramString, paramBundle, <span class="keyword">null</span>, <span class="number">0</span>, <span class="keyword">this</span>.mInitialTitleResId, <span class="keyword">this</span>.mInitialTitle);</span><br><span class="line">    finish();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ((!paramBoolean1) || (isValidFragment(paramString)))</span><br><span class="line">  &#123;</span><br><span class="line">    paramString = Fragment.instantiate(<span class="keyword">this</span>, paramString, paramBundle);</span><br><span class="line">    paramBundle = getFragmentManager().beginTransaction();</span><br><span class="line">    paramBundle.replace(<span class="keyword">this</span>.mMainContentId, paramString);</span><br><span class="line">    <span class="keyword">if</span> (paramBoolean3) &#123;</span><br><span class="line">      TransitionManager.beginDelayedTransition(<span class="keyword">this</span>.mContent);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (paramBoolean2) &#123;</span><br><span class="line">      paramBundle.addToBackStack(<span class="string">":settings:prefs"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (paramInt &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">break</span> label145;</span><br><span class="line">    &#125;</span><br><span class="line">    paramBundle.setBreadCrumbTitle(paramInt);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (;;)</span><br><span class="line">  &#123;</span><br><span class="line">    paramBundle.commitAllowingStateLoss();</span><br><span class="line">    getFragmentManager().executePendingTransactions();</span><br><span class="line">    <span class="keyword">return</span> paramString;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Invalid fragment for this activity: "</span> + paramString);</span><br><span class="line">    label145:</span><br><span class="line">    <span class="keyword">if</span> (paramCharSequence != <span class="keyword">null</span>) &#123;</span><br><span class="line">      paramBundle.setBreadCrumbTitle(paramCharSequence);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>从上面可以看出先通过指定的mFragment实例化fragment，然后通过FragmentTransaction的replace方法加载fragment。<br>通过上述分析，我们知道了Settings.apk如何通过隐式的Intent调转到对应的Activity布局。<br><em>当然到这一步还是不能帮我解决问题，还是没有解决魅族手机无法通过常见的方法跳到系统设置的无障碍服务的问题。</em></p>
<h2 id="FlymeAccessibilitySettings类"><a href="#FlymeAccessibilitySettings类" class="headerlink" title="FlymeAccessibilitySettings类"></a>FlymeAccessibilitySettings类</h2><p>从上面的分析我们已经能够知道魅族手机设置–&gt;辅助功能对应的Fragment是FlymeAccessibilitySettings这个类，源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlymeAccessibilitySettings</span>  <span class="keyword">extends</span> <span class="title">SettingsPreferenceFragment</span> </span></span><br><span class="line"><span class="class"><span class="keyword">implements</span> <span class="title">DialogInterface</span>.<span class="title">OnClickListener</span>, <span class="title">Preference</span>.<span class="title">OnPreferenceChangeListener</span>, <span class="title">Indexable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">....</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SettingsPreferenceFragment</span> <span class="keyword">extends</span> <span class="title">PreferenceFragment</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">DialogCreatable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出FlymeAccessibilitySettings是继承自PreferenceFragment类，它一个最重要的方法是调用addPreferencesFromResource()参数为xml资源id，来加载静态xml资源文件 （在res文件夹下新建xml文件夹，再在xml文件中新建对应的xml资源），完成Preference界面的构建。所以我们可以依次找到FlymeAccessibilitySettings对应的xml资源文件为mz_accessibility_settings.xml，内容如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span><br><span class="line">&lt;android.preference.PreferenceScreen android:title=<span class="string">"@string/accessibility_settings"</span></span><br><span class="line">  xmlns:android=<span class="string">"http://schemas.android.com/apk/prv/res/android"</span>&gt;</span><br><span class="line">    &lt;android.preference.PreferenceCategory android:title=<span class="string">"@string/interactive"</span> android:key=<span class="string">"interactive"</span> /&gt;</span><br><span class="line">    &lt;android.preference.Preference android:title=<span class="string">"@string/multi_task_title"</span> android:key=<span class="string">"multi_task"</span> android:widgetLayout=<span class="string">"@167968832"</span> android:fragment=<span class="string">"com.meizu.settings.accessibility.FlymeMultiTaskFragment"</span> /&gt;</span><br><span class="line">    &lt;android.preference.Preference android:title=<span class="string">"@string/quick_wakeup_title"</span> android:key=<span class="string">"quick_wakeup"</span> android:summary=<span class="string">"@string/quick_wakeup_tips"</span> android:widgetLayout=<span class="string">"@167968832"</span> android:fragment=<span class="string">"com.meizu.settings.accessibility.FlymeQuickWakeupFragment"</span> /&gt;</span><br><span class="line">    &lt;android.preference.Preference android:title=<span class="string">"@string/smart_voice_wakeup"</span> android:key=<span class="string">"smart_voice_wakeup"</span> android:summary=<span class="string">"@string/smart_voice_wakeup_tips"</span> android:widgetLayout=<span class="string">"@167968832"</span> /&gt;</span><br><span class="line">    &lt;android.preference.Preference android:title=<span class="string">"@string/smart_touch_title"</span> android:key=<span class="string">"smart_touch"</span> android:summary=<span class="string">"@string/smart_touch_tips"</span> android:widgetLayout=<span class="string">"@167968832"</span> android:fragment=<span class="string">"com.meizu.settings.accessibility.FlymeSmartTouchFragment"</span> /&gt;</span><br><span class="line">    &lt;android.preference.Preference android:title=<span class="string">"@string/force_touch_title"</span> android:key=<span class="string">"force_touch"</span> android:widgetLayout=<span class="string">"@167968832"</span> android:fragment=<span class="string">"com.meizu.settings.accessibility.ForceTouchSettingsFragment"</span> /&gt;</span><br><span class="line">    &lt;android.preference.PreferenceCategory android:title=<span class="string">"@string/header_category_lab"</span> android:key=<span class="string">"interactive"</span> /&gt;</span><br><span class="line">    &lt;android.preference.Preference android:title=<span class="string">"@string/safe_family_title"</span> android:key=<span class="string">"safe_family"</span> android:widgetLayout=<span class="string">"@167968832"</span> /&gt;</span><br><span class="line">    &lt;android.preference.Preference android:title=<span class="string">"@string/children_mode_title"</span> android:key=<span class="string">"children_mode"</span> android:widgetLayout=<span class="string">"@167968832"</span> /&gt;</span><br><span class="line">    &lt;android.preference.Preference android:title=<span class="string">"@string/app_clone_title"</span> android:key=<span class="string">"app_clone"</span> android:widgetLayout=<span class="string">"@167968832"</span> android:fragment=<span class="string">"com.meizu.settings.appclone.AppCloneSettings"</span> /&gt;</span><br><span class="line">    &lt;android.preference.Preference android:title=<span class="string">"@string/game_mode_title"</span> android:key=<span class="string">"game_mode"</span> android:widgetLayout=<span class="string">"@167968832"</span> android:fragment=<span class="string">"com.meizu.settings.accessibility.GameModeSettings"</span> /&gt;</span><br><span class="line">    &lt;android.preference.Preference android:title=<span class="string">"@string/red_envelope_title"</span> android:key=<span class="string">"red_envelope_assistant"</span> android:widgetLayout=<span class="string">"@167968832"</span> android:fragment=<span class="string">"com.meizu.settings.notificationstatusbar.FlymeRedEnvelopeAssistantSettings"</span> /&gt;</span><br><span class="line">    &lt;android.preference.Preference android:title=<span class="string">"@string/flashlamp_effects_title"</span> android:key=<span class="string">"flashlamp_effects"</span> android:widgetLayout=<span class="string">"@167968832"</span> android:fragment=<span class="string">"com.meizu.settings.accessibility.FlymeFlashLampEffectsSettings"</span> /&gt;</span><br><span class="line">    &lt;android.preference.Preference android:title=<span class="string">"@string/classic_mode"</span> android:key=<span class="string">"classic_mode"</span> android:widgetLayout=<span class="string">"@167968832"</span> android:fragment=<span class="string">"com.meizu.settings.accessibility.FlymeClassicModeFragment"</span> /&gt;</span><br><span class="line">    &lt;android.preference.PreferenceCategory android:title=<span class="string">"@string/accessiblity_category_system"</span> android:key=<span class="string">"accessiblity_category_system"</span> /&gt;</span><br><span class="line">    &lt;ListPreference android:persistent=<span class="string">"false"</span> android:entries=<span class="string">"@array/home_key_behavior_double_click_entries"</span> android:title=<span class="string">"@string/home_key_behavior_double_click"</span> android:key=<span class="string">"home_double_click"</span> android:entryValues=<span class="string">"@array/home_key_behavior_double_click_values"</span> /&gt;</span><br><span class="line">    &lt;ListPreference android:persistent=<span class="string">"false"</span> android:entries=<span class="string">"@array/home_key_behavior_entries"</span> android:title=<span class="string">"@string/home_key_behavior"</span> android:key=<span class="string">"home_long_press"</span> android:entryValues=<span class="string">"@array/home_key_behavior_values"</span> /&gt;</span><br><span class="line">    &lt;ListPreference android:persistent=<span class="string">"false"</span> android:entries=<span class="string">"@array/keyboard_back_behavior_entries"</span> android:title=<span class="string">"@string/keyboard_back_behavior"</span> android:key=<span class="string">"keyboard_back_behavior"</span> android:entryValues=<span class="string">"@array/keyboard_back_behavior_values"</span> /&gt;</span><br><span class="line">    &lt;com.meizu.common.preference.SwitchPreference android:persistent=<span class="string">"false"</span> android:title=<span class="string">"@string/headset_middlekey_wakeup"</span> android:key=<span class="string">"headset_middlekey_wakeup"</span> android:summary=<span class="string">"@string/headset_middlekey_wakeup_summay"</span> /&gt;</span><br><span class="line">    &lt;com.meizu.common.preference.SwitchPreference android:title=<span class="string">"@string/light_feedback_enable_title"</span> android:key=<span class="string">"light_feedback"</span> android:defaultValue=<span class="string">"true"</span> /&gt;</span><br><span class="line">    &lt;com.meizu.common.preference.SwitchPreference android:title=<span class="string">"@string/keyguard_palm_rejection_title"</span> android:key=<span class="string">"palm_rejection"</span> android:summary=<span class="string">"@string/keyguard_palm_rejection_summary"</span> android:defaultValue=<span class="string">"true"</span> /&gt;</span><br><span class="line">    &lt;com.meizu.common.preference.SwitchPreference android:title=<span class="string">"@string/hall_switch_title"</span> android:key=<span class="string">"use_cover"</span> android:summary=<span class="string">"@string/hall_switch_summary"</span> android:defaultValue=<span class="string">"true"</span> /&gt;</span><br><span class="line">    &lt;com.meizu.common.preference.SwitchPreference android:title=<span class="string">"@string/mcharge_title"</span> android:key=<span class="string">"fast_charge"</span> android:defaultValue=<span class="string">"true"</span> /&gt;</span><br><span class="line">    &lt;android.preference.Preference android:title=<span class="string">"@string/search_settings_title"</span> android:key=<span class="string">"search_settings"</span> android:widgetLayout=<span class="string">"@167968832"</span> /&gt;</span><br><span class="line">    &lt;android.preference.Preference android:title=<span class="string">"@string/scheduled_power_onandoff_title"</span> android:key=<span class="string">"scheduled_power"</span> android:widgetLayout=<span class="string">"@167968832"</span> android:fragment=<span class="string">"com.meizu.settings.scheduledpower.ScheduledPowerFragment"</span> /&gt;</span><br><span class="line">    &lt;android.preference.Preference android:title=<span class="string">"@string/drive_mode_title"</span> android:key=<span class="string">"drive_mode"</span> android:widgetLayout=<span class="string">"@167968832"</span> android:fragment=<span class="string">"com.meizu.settings.drivemode.MzDriveModeFragment"</span> /&gt;</span><br><span class="line">    &lt;android.preference.PreferenceScreen android:title=<span class="string">"@string/accessible"</span> android:key=<span class="string">"accessible_settings"</span> android:fragment=<span class="string">"com.android.settings.accessibility.AccessibilitySettings"</span> /&gt;</span><br><span class="line">    &lt;com.meizu.settings.calibration.ProximityCalibraton android:title=<span class="string">"@string/sensor_adjust_title"</span> android:key=<span class="string">"sensor_adjust_proximity"</span> /&gt;</span><br><span class="line">    &lt;com.meizu.settings.calibration.GsensorCalibration android:title=<span class="string">"@string/gsensor_calibrate_text"</span> android:key=<span class="string">"sensor_adjust_gsensor"</span> /&gt;</span><br><span class="line">    &lt;android.preference.Preference android:title=<span class="string">"@string/development_settings_title"</span> android:key=<span class="string">"development_settings"</span> android:widgetLayout=<span class="string">"@167968832"</span> android:fragment=<span class="string">"com.android.settings.DevelopmentSettings"</span> /&gt;</span><br><span class="line">    &lt;com.meizu.common.preference.SwitchPreference android:title=<span class="string">"@string/data_collection_title"</span> android:key=<span class="string">"data_collection"</span> /&gt;</span><br><span class="line">&lt;/android.preference.PreferenceScreen&gt;</span><br></pre></td></tr></table></figure></p>
<p>对照着手机界面，我们可以确认这个xml文件就是FlymeAccessibilitySettings类的静态资源文件，从中我们可以找到魅族手机无障碍服务对应的Fragment：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;android.preference.PreferenceScreen android:title=<span class="string">"@string/accessible"</span> android:key=<span class="string">"accessible_settings"</span> android:fragment=<span class="string">"com.android.settings.accessibility.AccessibilitySettings"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>在PreferenceFragment中点击列表项的点击监听方法为onPreferenceTreeClick()；在FlymeAccessibilitySettings类中的源码如下：<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onPreferenceTreeClick</span><span class="params">(PreferenceScreen paramPreferenceScreen, Preference paramPreference)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> m = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> j = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">this</span>.mUsageStatsProxy.reportData(<span class="string">"AccessibilitySettings"</span>, paramPreference.getKey(), paramPreference);</span><br><span class="line">  <span class="keyword">if</span> (paramPreference == <span class="keyword">this</span>.mHomeLightSwitchPreference)</span><br><span class="line">  &#123;</span><br><span class="line">    paramPreferenceScreen = <span class="keyword">this</span>.mContentResolver;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.mHomeLightSwitchPreference.isChecked()) &#123;</span><br><span class="line">      i = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Settings.System.putInt(paramPreferenceScreen, <span class="string">"light_feedback_enabled"</span>, i);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (paramPreference == <span class="keyword">this</span>.mDataCollectionSwitch)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.mDataCollectionSwitch.isChecked())</span><br><span class="line">    &#123;</span><br><span class="line">      warnDataCollection();</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Settings.System.putInt(<span class="keyword">this</span>.mContentResolver, <span class="string">"meizu_data_collection"</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (paramPreference == <span class="keyword">this</span>.mSearchPreference)</span><br><span class="line">  &#123;</span><br><span class="line">    paramPreferenceScreen = <span class="keyword">new</span> Intent();</span><br><span class="line">    paramPreferenceScreen.setAction(<span class="string">"com.meizu.net.search.setting"</span>);</span><br><span class="line">    paramPreferenceScreen.addFlags(<span class="number">335544320</span>);</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">      startActivity(paramPreferenceScreen);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (ActivityNotFoundException paramPreferenceScreen)</span><br><span class="line">    &#123;</span><br><span class="line">      Log.e(<span class="string">"AccessibilitySettings"</span>, <span class="string">"ActivityNotFoundException for search preference"</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (paramPreference == <span class="keyword">this</span>.mHeadsetMiddleKeyWakeupPreference)</span><br><span class="line">  &#123;</span><br><span class="line">    paramPreferenceScreen = <span class="keyword">this</span>.mContentResolver;</span><br><span class="line">    i = k;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.mHeadsetMiddleKeyWakeupPreference.isChecked()) &#123;</span><br><span class="line">      i = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Settings.System.putInt(paramPreferenceScreen, <span class="string">"headset_middle_key_wakeup"</span>, i);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (paramPreference == <span class="keyword">this</span>.mSmartVoiceWakeupPreference) &#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">      paramPreferenceScreen = <span class="keyword">new</span> Intent(<span class="string">"com.mediatek.voicecommand.VOICE_CONTROL_SETTINGS"</span>);</span><br><span class="line">      paramPreferenceScreen.addFlags(<span class="number">335544320</span>);</span><br><span class="line">      startActivity(paramPreferenceScreen);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (ActivityNotFoundException paramPreferenceScreen)</span><br><span class="line">    &#123;</span><br><span class="line">      Log.e(<span class="string">"AccessibilitySettings"</span>, <span class="string">"ActivityNotFoundException for MTK voice wakeup preference"</span>);</span><br><span class="line">      startFragment(<span class="keyword">this</span>, <span class="string">"com.meizu.settings.accessibility.FlymeSmartVoiceWakeupFragment"</span>, <span class="number">2131627644</span>, -<span class="number">1</span>, <span class="keyword">null</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.mFlymeInnovation.onPreferenceTreeClick(paramPreferenceScreen, paramPreference)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (paramPreference == <span class="keyword">this</span>.mPalmRejection)</span><br><span class="line">  &#123;</span><br><span class="line">    paramPreferenceScreen = <span class="keyword">this</span>.mContentResolver;</span><br><span class="line">    i = m;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.mPalmRejection.isChecked()) &#123;</span><br><span class="line">      i = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Settings.System.putInt(paramPreferenceScreen, <span class="string">"keyguard_palm_rejection"</span>, i);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (paramPreference == <span class="keyword">this</span>.mFastCharge) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.mFastCharge.isChecked())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">this</span>.mChargeDialog = <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>.mContext, <span class="number">5</span>).setMessage(<span class="number">2131628228</span>).setPositiveButton(<span class="number">17039379</span>, <span class="keyword">this</span>).setNegativeButton(<span class="number">17039369</span>, <span class="keyword">this</span>).show();</span><br><span class="line">      <span class="keyword">this</span>.mChargeDialog.setOnDismissListener(<span class="keyword">new</span> DialogInterface.OnDismissListener()</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDismiss</span><span class="params">(DialogInterface paramAnonymousDialogInterface)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">          <span class="keyword">boolean</span> bool = <span class="keyword">true</span>;</span><br><span class="line">          paramAnonymousDialogInterface = FlymeAccessibilitySettings.-get4(FlymeAccessibilitySettings.<span class="keyword">this</span>);</span><br><span class="line">          <span class="keyword">if</span> (Settings.Global.getInt(FlymeAccessibilitySettings.-get0(FlymeAccessibilitySettings.<span class="keyword">this</span>), <span class="string">"mz_fast_charge"</span>, <span class="number">1</span>) == <span class="number">1</span>) &#123;&#125;</span><br><span class="line">          <span class="keyword">for</span> (;;)</span><br><span class="line">          &#123;</span><br><span class="line">            paramAnonymousDialogInterface.setChecked(bool);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">            bool = <span class="keyword">false</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (;;)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onPreferenceTreeClick(paramPreferenceScreen, paramPreference);</span><br><span class="line">    Settings.Global.putInt(<span class="keyword">this</span>.mContentResolver, <span class="string">"mz_fast_charge"</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">if</span> (paramPreference == <span class="keyword">this</span>.mHallSwitch)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">boolean</span> bool = <span class="keyword">this</span>.mHallSwitch.isChecked();</span><br><span class="line">      ContentResolver localContentResolver = <span class="keyword">this</span>.mContentResolver;</span><br><span class="line">      <span class="keyword">if</span> (bool) &#123;&#125;</span><br><span class="line">      <span class="keyword">for</span> (i = j;; i = <span class="number">0</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        Settings.System.putInt(localContentResolver, <span class="string">"hall_switch"</span>, i);</span><br><span class="line">        <span class="keyword">this</span>.mUsageStatsProxy.reportData(FlymeAccessibilitySettings.class.getSimpleName(), paramPreference.getKey(), paramPreference);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (paramPreference == <span class="keyword">this</span>.mSafeFamilyPreference) &#123;</span><br><span class="line">      startActivity(getBreakingScamIntent());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>从上面我们可以分析出对辅助功能界面各个item的处理，不过最重要的对无障碍的处理是<figure class="highlight plain"><figcaption><span>paramPreference)```，继续跟踪下去，FlymeAccessibilitySettings的父类为SettingsPreferenceFragment，源码如下：</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">```java</span><br><span class="line">  public boolean onPreferenceTreeClick(PreferenceScreen paramPreferenceScreen, Preference paramPreference)</span><br><span class="line">  &#123;</span><br><span class="line">    if (paramPreference.getFragment() != null) &#123;</span><br><span class="line">      return ((SettingsActivity)getActivity()).onPreferenceStartFragment(this, paramPreference);</span><br><span class="line">    &#125;</span><br><span class="line">    return super.onPreferenceTreeClick(paramPreferenceScreen, paramPreference);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>因为无障碍服务对应的是另一个Fragment，所以进入if块，调用onPreferenceStartFragment()，源码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onPreferenceStartFragment</span><span class="params">(SettingsPreferenceFragment paramSettingsPreferenceFragment, android.preference.Preference paramPreference)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  paramSettingsPreferenceFragment = paramPreference.getTitle();</span><br><span class="line">  <span class="keyword">if</span> (paramPreference.getFragment().equals(WallpaperTypeSettings.class.getName())) &#123;</span><br><span class="line">    paramSettingsPreferenceFragment = getString(<span class="number">2131625303</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  startPreferencePanel(paramPreference.getFragment(), paramPreference.getExtras(), -<span class="number">1</span>, paramSettingsPreferenceFragment, <span class="keyword">null</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startPreferencePanel</span><span class="params">(String paramString, Bundle paramBundle, <span class="keyword">int</span> paramInt1, CharSequence paramCharSequence, Fragment paramFragment, <span class="keyword">int</span> paramInt2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  String str = <span class="keyword">null</span>;</span><br><span class="line">  <span class="keyword">if</span> (paramInt1 &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (paramCharSequence == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">break</span> label39;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  label39:</span><br><span class="line">  <span class="keyword">for</span> (str = paramCharSequence.toString();; str = <span class="string">""</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    Utils.startWithFragment(<span class="keyword">this</span>, paramString, paramBundle, paramFragment, paramInt2, paramInt1, str, <span class="keyword">this</span>.mIsShortcut);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>到这一步可以发现最终调用的是<figure class="highlight plain"><figcaption><span>too young too native</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">继续往下看：</span><br><span class="line">```java</span><br><span class="line">  public static void startWithFragment(Context paramContext, String paramString, Bundle paramBundle, Fragment paramFragment, int paramInt1, int paramInt2, CharSequence paramCharSequence, boolean paramBoolean)</span><br><span class="line">  &#123;</span><br><span class="line">    paramString = onBuildStartFragmentIntent(paramContext, paramString, paramBundle, null, paramInt2, paramCharSequence, paramBoolean);</span><br><span class="line">    if (paramFragment == null)</span><br><span class="line">    &#123;</span><br><span class="line">      paramContext.startActivity(paramString);</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">    paramFragment.startActivityForResult(paramString, paramInt1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public static Intent onBuildStartFragmentIntent(Context paramContext, String paramString1, Bundle paramBundle, String paramString2, int paramInt, CharSequence paramCharSequence, boolean paramBoolean)</span><br><span class="line">  &#123;</span><br><span class="line">    Intent localIntent = new Intent(&quot;android.intent.action.MAIN&quot;);</span><br><span class="line">    localIntent.setClass(paramContext, SubSettings.class);</span><br><span class="line">    localIntent.putExtra(&quot;:settings:show_fragment&quot;, paramString1);</span><br><span class="line">    localIntent.putExtra(&quot;:settings:show_fragment_args&quot;, paramBundle);</span><br><span class="line">    localIntent.putExtra(&quot;:settings:show_fragment_title_res_package_name&quot;, paramString2);</span><br><span class="line">    localIntent.putExtra(&quot;:settings:show_fragment_title_resid&quot;, paramInt);</span><br><span class="line">    localIntent.putExtra(&quot;:settings:show_fragment_title&quot;, paramCharSequence);</span><br><span class="line">    localIntent.putExtra(&quot;:settings:show_fragment_as_shortcut&quot;, paramBoolean);</span><br><span class="line">    return localIntent;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>不难发现从调用无障碍服务的方式是startActivityForResult()，在这个之前会先调用onBuildStartFragmentInten()构造一个intent。首先我们看到方法内部所调用的Activity为SubSettings类，源码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubSettings</span> <span class="keyword">extends</span> <span class="title">SettingsActivity</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isValidFragment</span><span class="params">(String paramString)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    Log.d(<span class="string">"SubSettings"</span>, <span class="string">"Launching fragment "</span> + paramString);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onNavigateUp</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    finish();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>SubSettings继承自SettingsActivity，我们在之前的分析已经能得出SettingsActivity加载Fragment的方式是从AndroidManifest.xml的Activity标签中获取meta-data中key为<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">```java</span><br><span class="line">        &lt;activity android:configChanges=&quot;keyboardHidden|orientation|screenSize&quot; android:exported=&quot;true&quot; android:name=&quot;com.android.settings.SubSettings&quot; android:parentActivityName=&quot;com.android.settings.Settings&quot; android:permission=&quot;com.meizu.permission.SEARCH_SETTINGS&quot; android:screenOrientation=&quot;portrait&quot; android:taskAffinity=&quot;com.android.settings&quot;&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=&quot;android.intent.action.SEARCH&quot;/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">            &lt;meta-data android:name=&quot;android.app.searchable&quot; android:resource=&quot;@xml/searchable&quot;/&gt;</span><br><span class="line">        &lt;/activity&gt;</span><br></pre></td></tr></table></figure></p>
<p>并没有我们所需要的值，但在getIntent中我们可以发现intent值来自<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">代码如下：</span><br><span class="line">```java</span><br><span class="line">        intent.setAction(&quot;android.intent.action.SEARCH&quot;);</span><br><span class="line">        intent.setComponent(new ComponentName(&quot;com.android.settings&quot;, &quot;com.android.settings.SubSettings&quot;));</span><br><span class="line">        intent.putExtra(PreferenceActivity.EXTRA_SHOW_FRAGMENT, &quot;com.android.settings.accessibility.AccessibilitySettings&quot;);</span><br><span class="line">        startActivity(intent);</span><br></pre></td></tr></table></figure></p>
<p>因为跳转SubSettings这个Activity需要声明一个permission，所以我们必须在我们应用加上这个权限声明，但是这会引来另一个问题：<strong>Failure [INSTALL_FAILED_DUPLICATE_PERMISSION</strong>，这个错误的意思是正要安装的APP的自定义权限与手机上已有APP的自定义权限名字相同，但两个APP具有不同的签名信息导致安装失败。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/18/关于AlertDialog的小知识/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Forwards">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forwards">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/18/关于AlertDialog的小知识/" itemprop="url">关于AlertDialog点击按钮弹窗自动dismiss的源码分析及解决方案</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-18T22:05:21+08:00">
                2018-04-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="关于AlertDialog点击按钮弹窗自动dismiss的源码分析及解决方案"><a href="#关于AlertDialog点击按钮弹窗自动dismiss的源码分析及解决方案" class="headerlink" title="关于AlertDialog点击按钮弹窗自动dismiss的源码分析及解决方案"></a>关于AlertDialog点击按钮弹窗自动dismiss的源码分析及解决方案</h1><p>前言：在使用AlertDialog时，发现即使没有调用dismiss()点击取消或者确定按钮对话框都会自动关闭，看了源码才发现，这一操作在源码已经写死了。</p>
<h2 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h2><p>首先我们先看下AlertDialog的一般用法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">AlertDialog.Builder builder = <span class="keyword">new</span> AlertDialog.Builder(getActivity())</span><br><span class="line">		.setTitle(<span class="string">"提示"</span>)</span><br><span class="line">		.setMessage(featureContent)</span><br><span class="line">		.setPositiveButton(<span class="string">"确定"</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">		AlertDialog dialog = builder.create();</span><br><span class="line">		dialog.setCancelable(<span class="keyword">true</span>);</span><br><span class="line">		dialog.setCanceledOnTouchOutside(<span class="keyword">true</span>);</span><br><span class="line">		dialog.show();</span><br></pre></td></tr></table></figure>
<p>AlertDialog采用Builder进行构造参数的配置，最后通过show()方法返回一个已配置的AlertDialog实例。<br>从API调用我们可以知道应该先从AlertDialog.Builder入手查起，看看Builder的构造器都做了什么。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">this</span>(context, resolveDialogTheme(context, <span class="number">0</span>));</span><br><span class="line"> &#125;</span><br><span class="line">		</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">(Context context, <span class="keyword">int</span> theme)</span> </span>&#123;</span><br><span class="line">     P = <span class="keyword">new</span> AlertController.AlertParams(<span class="keyword">new</span> ContextThemeWrapper(</span><br><span class="line">             context, resolveDialogTheme(context, theme)));</span><br><span class="line">     mTheme = theme;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>接着分析builder.setPositiveButton()方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Builder <span class="title">setPositiveButton</span><span class="params">(CharSequence text, <span class="keyword">final</span> OnClickListener listener)</span> </span>&#123;</span><br><span class="line">    P.mPositiveButtonText = text;</span><br><span class="line">    P.mPositiveButtonListener = listener;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>从上面的代码我们可以看出最终的操作都指向了AlertController这个类（AlertController类是Android的内部类，在com.android.internal.app包中，无法通过普通的方式访问，也无法在eclipse通过按Ctrl键跟踪进源代码），在AlertController的构造器中我们看到了一个Hanlder类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">AlertController</span><span class="params">(Context context, DialogInterface di, Window window)</span> </span>&#123;</span><br><span class="line">      mContext = context;</span><br><span class="line">      mDialogInterface = di;</span><br><span class="line">      mWindow = window;</span><br><span class="line">      mHandler = <span class="keyword">new</span> ButtonHandler(di);</span><br><span class="line">...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>再看下ButtonHandler的实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ButtonHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Button clicks have Message.what as the BUTTON&#123;1,2,3&#125; constant</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MSG_DISMISS_DIALOG = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> WeakReference&lt;DialogInterface&gt; mDialog;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ButtonHandler</span><span class="params">(DialogInterface dialog)</span> </span>&#123;</span><br><span class="line">        mDialog = <span class="keyword">new</span> WeakReference&lt;DialogInterface&gt;(dialog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">case</span> DialogInterface.BUTTON_POSITIVE:</span><br><span class="line">            <span class="keyword">case</span> DialogInterface.BUTTON_NEGATIVE:</span><br><span class="line">            <span class="keyword">case</span> DialogInterface.BUTTON_NEUTRAL:</span><br><span class="line">                ((DialogInterface.OnClickListener) msg.obj).onClick(mDialog.get(), msg.what);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">case</span> MSG_DISMISS_DIALOG:</span><br><span class="line">                ((DialogInterface) msg.obj).dismiss();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在这里我们看到了熟悉的dismiss()方法。而在这个类的开头我们就发现了OnClickListener事件的实例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">View.OnClickListener mButtonHandler = <span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Message m = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (v == mButtonPositive &amp;&amp; mButtonPositiveMessage != <span class="keyword">null</span>) &#123;</span><br><span class="line">            m = Message.obtain(mButtonPositiveMessage);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v == mButtonNegative &amp;&amp; mButtonNegativeMessage != <span class="keyword">null</span>) &#123;</span><br><span class="line">            m = Message.obtain(mButtonNegativeMessage);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v == mButtonNeutral &amp;&amp; mButtonNeutralMessage != <span class="keyword">null</span>) &#123;</span><br><span class="line">            m = Message.obtain(mButtonNeutralMessage);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (m != <span class="keyword">null</span>) &#123;</span><br><span class="line">            m.sendToTarget();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Post a message so we dismiss after the above handlers are executed</span></span><br><span class="line">        mHandler.obtainMessage(ButtonHandler.MSG_DISMISS_DIALOG, mDialogInterface)</span><br><span class="line">                .sendToTarget();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>这段代码的前几行用来触发对话框中的三个按钮，而在最后的代码就是通过mHandler来关闭对话框的。</p>
<p><strong>总结</strong><br>总结对话框单击事件的处理过程：在AlertController类处理对话框按钮时会为每个按钮添加一个onClick事件，而这个事件的实例就是上面的mButtonHandler，在这个实例中会通过发消息的方式调用为按钮设置的单击事件，在触发完按钮的单击事件后，会通过发消息的方式调用dismiss()来关闭对话框，这就是没有调用dismiss()点击取消或者确定按钮对话框都会自动关闭的原因。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ol>
<li>使用我们自己的Hanlder对象来替换掉ButtonHandler就可以阻止AlertDialog调用dismiss()关闭对话框。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyButtonHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> WeakReference&lt;DialogInterface&gt; mDialog;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyButtonHandler</span><span class="params">(Dialog dialog)</span> </span>&#123;</span><br><span class="line">		mDialog = <span class="keyword">new</span> WeakReference&lt;DialogInterface&gt;(dialog);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">		<span class="keyword">case</span> DialogInterface.BUTTON_POSITIVE:</span><br><span class="line">		<span class="keyword">case</span> DialogInterface.BUTTON_NEGATIVE:</span><br><span class="line">		<span class="keyword">case</span> DialogInterface.BUTTON_NEUTRAL:</span><br><span class="line">			((DialogInterface.OnClickListener)msg.obj).onClick(mDialog.get(), msg.what);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面自定义的Handler类和源代码相比只去掉了最后一个case语句。<br>然后在dialog调用show()方法之前为AlertController类的mHandler变量重新赋值。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 通过获取字段，然后设定setAccessible为true，即可访问私有变量</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	Field field = dialog.getClass().getDeclaredField(<span class="string">"mAlert"</span>);</span><br><span class="line">	field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">		</span><br><span class="line">	Object obj = field.get(dialog);</span><br><span class="line">	field = obj.getClass().getDeclaredField(<span class="string">"mHandler"</span>);</span><br><span class="line">	field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">	field.set(obj, <span class="keyword">new</span> MyButtonHandler(dialog));</span><br><span class="line">&#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">dialog.show();</span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li>从dismiss()方法上做手脚解决。我们可以先看一下dismiss()的代码：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dismiss</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Looper.myLooper() == mHandler.getLooper()) &#123;</span><br><span class="line">        dismissDialog();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        mHandler.post(mDismissAction);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dismissDialog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mDecor == <span class="keyword">null</span> || !mShowing) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mWindow.isDestroyed()) &#123;</span><br><span class="line">        Log.e(TAG, <span class="string">"Tried to dismissDialog() but the Dialog's window was already destroyed!"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        mWindowManager.removeViewImmediate(mDecor);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mActionMode != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mActionMode.finish();</span><br><span class="line">        &#125;</span><br><span class="line">        mDecor = <span class="keyword">null</span>;</span><br><span class="line">        mWindow.closeAllPanels();</span><br><span class="line">        onStop();</span><br><span class="line">        mShowing = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        sendDismissMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在dismissDialog()内部会先判断对话框是否关闭(对应mShowing标识位)，所以我们可以在代码中设置这个值，使系统认为对话框已经关闭。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	Field field = dialog.getClass().getSuperclass().getDeclaredField(<span class="string">"mShowing"</span>);</span><br><span class="line">	field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">	field.set(dialog, <span class="keyword">false</span>);</span><br><span class="line">	dialog.dismiss();</span><br><span class="line">&#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/01/1.1 Activity的LaunchMode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Forwards">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forwards">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/01/1.1 Activity的LaunchMode/" itemprop="url">Activity的启动模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-01T15:25:54+08:00">
                2018-04-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文结构：</p>
<p><img src="http://sdssdccddd.gitee.io/myblogimg/ActivityLaunchMode.png" alt="ActivityLaunchMode"></p>
<p>前言：介绍Activity的启动模式之前先介绍一下任务栈。任务栈是一个“后进先出”的栈结构，每按一下back键就有一个Activity出栈，直到栈空为止，当栈中无任何Activity的时候，系统就会回收这个任务栈。</p>
<h2 id="1-1-Activity的LaunchMode"><a href="#1-1-Activity的LaunchMode" class="headerlink" title="1.1 Activity的LaunchMode"></a>1.1 Activity的LaunchMode</h2><p>Activity的LaunchMode目前有四种启动模式：standard、singleTop、singleTask以及singleInstance。</p>
<ol>
<li>standard：标准模式，也是系统的默认模式。每次启动一个Activity都会重新创建一个新的实例，不管这个实例是否已经存在。这种模式是典型的多实例实现，一个任务栈中可以有多个实例，每个实例也可以属于不同的任务栈。在这种模式下，谁启动了这个Activity，那么这个Activity就运行在启动它的那个Activity的所在的栈中。</li>
</ol>
<p>注意：当我们用ApplicationContext去启动standard模式的Activity的时候就会报错，log如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...Calling startActivity from outside of an Activity context <span class="keyword">requires</span> the FLAG_ACTIVITY_NEW_TASK flag....</span><br></pre></td></tr></table></figure>
<p>这是因为standard模式下的Activity默认会进入启动它的Activity所属的任务栈中，但是由于非Activity类型的context并没有任务栈，所以解决这个问题的办法是为待启动Activity指定FLAG_ACTIVITY_NEW_TASK标记位。这个时候待启动Activity实际上是以singleTask模式启动的。</p>
<ol start="2">
<li>singleTop：栈顶复用模式。在这种模式下，如果新Activity已经位于任务栈的栈顶，那么此Activity不会被重新创建，同时它的onNewIntent方法会被回调，通过此方法的参数我们就可以取出当前请求的信息；如果新Activity的实例已经存在但不是位于栈顶，那么新Activity会被重新创建。</li>
<li>singleTask：栈内复用模式。这是一种单实例模式，在这种模式下，只要Activity在一个栈中存在，那么多次启动这个Activity都不会重新创建实例，同时系统会回调其onNewIntent。具体一点，当一个具有singleTask模式的Activity请求启动后，系统会首先寻找是否存在<strong>这个Activity想要的任务栈</strong>，如果不存在，就重新创建一个任务栈，然后创建这个Activity的实例后把这个Activity放入栈中，如果存在，这是要看这个Activity是否在栈中有实例存在，如果有实例存在，那么系统会把这个Activity调到栈顶并调用它的onNewIntent，如果实例不存在，就创建这个Activity的实例并将其压入栈中。<br>例子：如果D所需的任务栈为S1，并且当前S1的情况为ADBC，根据栈内复用原则，此时D不会被重新创建，系统会把D切换到栈顶并调用其onNewIntent，同时由于singleTask默认默认具有clearTop的效果，会导致栈内所有在D上面的Activity全部出栈，最终S1中的情况为AD。</li>
<li>singleInstance：单实例模式，加强版的singleTask模式，它除了具有singleTask的所有特性外，还加强了一点，那就是此模式下的Activity只能单独的位于一个任务栈中。</li>
</ol>
<p>什么是Activity所需要的任务栈？这要从一个参数说起：TaskAffinity，任务相关性。这个参数标识了一个Activity所需要的任务栈的名字，默认情况下所有Activity所需的任务栈的名字为应用的包名，但是我们可以为每个Activity都单独指定TaskAffinity属性，这个属性值不能和包名一样，否则就相当于没有指定。TaskAffinity属性主要和singleTask启动模式和allowTaskReparenting属性配对使用，在其他情况下没有意义。</p>
<h2 id="1-2-如何给Activity指定启动模式"><a href="#1-2-如何给Activity指定启动模式" class="headerlink" title="1.2 如何给Activity指定启动模式"></a>1.2 如何给Activity指定启动模式</h2><ol>
<li><p>通过AndroidMenifest为Activity指定启动模式。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity</span><br><span class="line">	android:name=<span class="string">"com.my.test.TestActivity"</span></span><br><span class="line">	android:launchMode=<span class="string">"singleTask"</span></span><br><span class="line">	android:label=<span class="string">"@string/app_name"</span>&gt;</span><br><span class="line">&lt;/activity&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过在Intent设置标志位来为Activity指定启动模式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, TestActivity.class);</span><br><span class="line">intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>二者区别：首先，优先级上第二种高于第一种，当两种同时存在时，以第二种为准；其次，二者在限定范围上有所不同。</p>
<h2 id="1-3-Activity的Flags"><a href="#1-3-Activity的Flags" class="headerlink" title="1.3 Activity的Flags"></a>1.3 Activity的Flags</h2><ol>
<li>FLAG_ACTIVITY_NEW_TASK：这个标记位的作用是为Activity指定“singleTask”启动模式。</li>
<li>FLAG_ACTIVITY_SINGLE_TOP：这个标记位的作用是为Activity指定“singleTop”启动模式。</li>
<li>FLAG_ACTIVITY_CLEAR_TOP：具有此标记位的Activity，当它启动时，在同一个任务栈中所有位于它上面的Activity都要出栈，这个标记位一般和singleTask启动模式一起出现。在这种情况下，如果被启动的实例已经存在，那么系统会调用它的onNewIntent。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/25/Annotation注解类/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Forwards">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forwards">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/25/Annotation注解类/" itemprop="url">Annotation注解类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-25T00:13:22+08:00">
                2018-01-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Annotation注解类"><a href="#Annotation注解类" class="headerlink" title="Annotation注解类"></a>Annotation注解类</h1><p>本文结构：<br><img src="http://pcmve13p6.bkt.clouddn.com/static/images/Annotation.png"></p>
<p><img src="http://sdssdccddd.gitee.io/myblogimg/Annotation.png" alt="Annotation.png"></p>
<h2 id="1-概念"><a href="#1-概念" class="headerlink" title="1. 概念"></a>1. 概念</h2><p> Java Annotation是JDK5.0引入的一种注释机制。</p>
<p> 关于Annotation注解的概念，我们可以先看下官方的解释：</p>
<blockquote>
<p>Annotations, a form of metadata;<br>provide data about a program that is not part of the program itself.<br>Annotations have no direct effect on the operation of the code they annotate</p>
</blockquote>
<p>Annotation注解是Java中的一种元数据，它可以往程序中添加额外的数据，并且对注解的代码无直接的影响。注解是一种接口，可以作用于包名、类、方法、属性、参数等。它可以通过反射机制来访问annotation信息，获得所加的注解信息。</p>
<h2 id="2-Java-lang中的注解"><a href="#2-Java-lang中的注解" class="headerlink" title="2. Java.lang中的注解"></a>2. Java.lang中的注解</h2><p> Java.lang中的注解又称为标准Annotation，即常用到的Deprecated、Override和SuppressWarnings。<br> （1）@Deprecated 过时：表示该方法已过时，建议使用新的一些方法代替。<br> （2）@Override 复写：表示复写父类的方法，如果方法上有这条注解但没有重写父类方法，则会生成一条错误信息。这个注解保证了方法一定会被复写。比如在开发过程中，手动在子类中复写父类的方法，只正确写出了方法名称，未写出正确的方法参数，则相当于方法的重载，并不是复写。所以使用@Override注解，有效地表明，此方法是复写父类的方法，不会产生手动的错误问题。<br> （3）@SuppressWarnings 阻止警告，阻止弹出的警告，比如加上此注解可屏蔽上述过时的警告。</p>
<h2 id="3-元注解"><a href="#3-元注解" class="headerlink" title="3. 元注解"></a>3. 元注解</h2><p>元注解是指注解Annotation的注解。以Override的源代码为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)  </span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.SOURCE)  </span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Override &#123;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注解类的定义方法以及注解类上所加的注解。元注解有四个，位于java.lang.annotation包中：Target，Retention，Documented、Inherited。</p>
<p>3.1  @Target 表示注解作用的目标。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(ElementType.ANNOTATION_TYPE)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Target&#123;</span><br><span class="line">	ElementType[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 注解作用的目标由枚举类ElementType决定。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ElementType&#123;</span><br><span class="line">	TYPE,<span class="comment">//类、接口、注解类型或枚举</span></span><br><span class="line">	FIELD,<span class="comment">//属性</span></span><br><span class="line">	METHOD,<span class="comment">//方法</span></span><br><span class="line">	PARAMETER,<span class="comment">//用于描述参数</span></span><br><span class="line">	CONSTRUCTOR,<span class="comment">//构造方法</span></span><br><span class="line">	LOCAL_VARIABLE,<span class="comment">//局部变量</span></span><br><span class="line">	ANNOTATION_TYPE,<span class="comment">//注解类</span></span><br><span class="line">	PACKAGE,<span class="comment">//包</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注</strong>：Class，interface等都实现了java中的Type接口，因此ElementType.TYPE表示注解作用于这些“类”（并不是单纯的Class类）</p>
<p>3.2 @Retention 表示注解的作用时段</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(ElementType.ANNOTATION_TYPE)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Target&#123;</span><br><span class="line">	<span class="function">RetentionPolicy <span class="title">value</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由源码可见，Retention定义的是RetentionPolicy类型的数据<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> RetentionPolicy&#123;</span><br><span class="line">	SOURCE,<span class="comment">//表示注解只在源文件中保留</span></span><br><span class="line">	CLASS,<span class="comment">//表示注解保留到.class文件中</span></span><br><span class="line">	RUNTIME,<span class="comment">//表示注解一直保留到内存中，类加载器把.class文件加载到内存中产生的字节码中要保留注解信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>3.3 @Documented 表示javadoc所生成的文档会带上注解信息。<br>3.4 @Inherited 表示子类可以集成加载父类上的注解，但要注意：（1）注解定义在类上面，子类可以继承该注解；（2）注解定义在方法上，子类也可继承该注解；但是如果子类复写了父类中定义了注解的方法，子类将无法继承该方法上的注解；（3）Interface的实现类无法继承接口中所定义的被@Inherited标注的注解</p>
<h2 id="4-注解的参数"><a href="#4-注解的参数" class="headerlink" title="4. 注解的参数"></a>4. 注解的参数</h2><p>参数类型支持基本数据类型、Class类型、enum类型、Annotation类型以及上述所有类型的数组。</p>
<h2 id="5-自定义注解"><a href="#5-自定义注解" class="headerlink" title="5. 自定义注解"></a>5. 自定义注解</h2><p>步骤：</p>
<ol>
<li>使用@interface定义一个注解类（其内部自行继承了Annotation类）</li>
<li>在该类中定义注解的参数（类似定义方法）</li>
<li>注解元素必须由确定的值，可在定义注解的默认值中指定，也可在使用注解时指定（非基本类型的注解元素的值不可为null）<br>example：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Car&#123;</span><br><span class="line">	<span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">number</span><span class="params">()</span> <span class="keyword">default</span> -1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Car</span>(name = <span class="string">"宝马"</span>, number = <span class="number">666</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarBWM</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		<span class="comment">//判断CarBMW是否有注解类Car</span></span><br><span class="line">		<span class="keyword">if</span>(CarBMW.class.isAnnotationPresent(Car.class))&#123;</span><br><span class="line">			Car carAnnotation = (Car)CarBMW.class.getAnnotation(Car.class);</span><br><span class="line">			System.out.println(<span class="string">"car name "</span> + carAnnotation.name());</span><br><span class="line">			System.out.println(<span class="string">"car number "</span> + carAnnotation.number());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/31/Fragment学习之 懒加载 + Fragment在ViewPager中的生命周期/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Forwards">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forwards">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/31/Fragment学习之 懒加载 + Fragment在ViewPager中的生命周期/" itemprop="url">Fragment学习之 懒加载 + Fragment在ViewPager中的生命周期</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-31T22:08:36+08:00">
                2017-07-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Fragment学习之-懒加载-Fragment在ViewPager中的生命周期"><a href="#Fragment学习之-懒加载-Fragment在ViewPager中的生命周期" class="headerlink" title="Fragment学习之 懒加载 + Fragment在ViewPager中的生命周期"></a>Fragment学习之 懒加载 + Fragment在ViewPager中的生命周期</h1><p>前言：最近做了个新项目，第一次用到了Fragment的懒加载，顺便学习了下ViewPager的预加载。</p>
<h2 id="ViewPager的预加载"><a href="#ViewPager的预加载" class="headerlink" title="ViewPager的预加载"></a>ViewPager的预加载</h2><p>首先说明一下什么是ViewPager的预加载：默认情况下ViewPager会把当前Fragment的左右相邻页面预先初始化（俗称预加载），比如你当前在第二个Fragment的页面，其实左右第一和第三的Fragment已经初始化好了，这样做的好处是ViewPager左右滑动更流畅。我们可以写个简单例子（部分代码）：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        NoScrollViewPager viewPager = (NoScrollViewPager) findViewById(R.id.viewPager);</span><br><span class="line">        viewPager.setAdapter(<span class="keyword">new</span> MainAdapter(getSupportFragmentManager()));</span><br><span class="line">        AlphaIndicator alphaIndicator = (AlphaIndicator) findViewById(R.id.alphaIndicator);</span><br><span class="line">        alphaIndicator.setViewPager(viewPager);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MainAdapter</span> <span class="keyword">extends</span> <span class="title">FragmentPagerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> List&lt;Fragment&gt; fragments = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MainAdapter</span><span class="params">(FragmentManager fm)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(fm);</span><br><span class="line">            fragments.add(<span class="keyword">new</span> Fragment01());</span><br><span class="line">            fragments.add(<span class="keyword">new</span> Fragment02());</span><br><span class="line">            fragments.add(<span class="keyword">new</span> Fragment03());</span><br><span class="line">            fragments.add(<span class="keyword">new</span> Fragment04());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Fragment <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> fragments.get(position);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> fragments.size();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Fragment01.java:</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Fragment01</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"Fragment"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAttach</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onAttach(context);</span><br><span class="line">        Log.d(TAG, <span class="string">"Fragment01 ==&gt; onAttach()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        Log.d(TAG, <span class="string">"Fragment01 ==&gt; onCreateView()"</span>);</span><br><span class="line">        <span class="comment">//引用创建好的xml布局</span></span><br><span class="line">        View view = inflater.inflate(R.layout.item01,container,<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">return</span> view;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroyView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroyView();</span><br><span class="line">        Log.d(TAG, <span class="string">"Fragment01 ==&gt; onDestroyView()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        Log.d(TAG, <span class="string">"Fragment01 ==&gt; onDestroy()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后我们运行并打印日志：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">07</span>-<span class="number">31</span> <span class="number">08</span>:<span class="number">51</span>:<span class="number">29.809</span> <span class="number">1987</span>-<span class="number">1987</span>/? D/Fragment: Fragment01 ==&gt; onAttach()</span><br><span class="line"><span class="number">07</span>-<span class="number">31</span> <span class="number">08</span>:<span class="number">51</span>:<span class="number">29.809</span> <span class="number">1987</span>-<span class="number">1987</span>/? D/Fragment: Fragment02 ==&gt; onAttach()</span><br><span class="line"><span class="number">07</span>-<span class="number">31</span> <span class="number">08</span>:<span class="number">51</span>:<span class="number">29.809</span> <span class="number">1987</span>-<span class="number">1987</span>/? D/Fragment: Fragment01 ==&gt; onCreateView()</span><br><span class="line"><span class="number">07</span>-<span class="number">31</span> <span class="number">08</span>:<span class="number">51</span>:<span class="number">29.856</span> <span class="number">1987</span>-<span class="number">1987</span>/? D/Fragment: Fragment02 ==&gt; onCreateView()</span><br><span class="line"><span class="number">07</span>-<span class="number">31</span> <span class="number">08</span>:<span class="number">51</span>:<span class="number">42.110</span> <span class="number">1987</span>-<span class="number">1987</span>/? D/Fragment: Fragment03 ==&gt; onAttach()</span><br><span class="line"><span class="number">07</span>-<span class="number">31</span> <span class="number">08</span>:<span class="number">51</span>:<span class="number">42.110</span> <span class="number">1987</span>-<span class="number">1987</span>/? D/Fragment: Fragment03 ==&gt; onCreateView()</span><br><span class="line">                                           </span><br><span class="line">                                           [ <span class="number">07</span>-<span class="number">31</span> <span class="number">08</span>:<span class="number">51</span>:<span class="number">42.319</span>    <span class="number">81</span>:   <span class="number">81</span> D/         ]</span><br><span class="line">                                           Socket deconnection</span><br><span class="line"><span class="number">07</span>-<span class="number">31</span> <span class="number">08</span>:<span class="number">55</span>:<span class="number">21.653</span> <span class="number">1987</span>-<span class="number">1987</span>/? D/Fragment: Fragment04 ==&gt; onAttach()</span><br><span class="line"><span class="number">07</span>-<span class="number">31</span> <span class="number">08</span>:<span class="number">55</span>:<span class="number">21.653</span> <span class="number">1987</span>-<span class="number">1987</span>/? D/Fragment: Fragment04 ==&gt; onCreateView</span><br></pre></td></tr></table></figure></p>
<p>从日志中我们可以看出，当位于Fragment02时，Fragment01和Fragment03是已经初始化完成了的，viewpager预加载是3页。这种特性会导致资源浪费：</p>
<ul>
<li>预加载不可见的Fragment时，初始化数据和其页面会占用大量资源（用户很可能只看第一个，后面两个不想看了）</li>
<li>如果当前页面内有动画或其他持续性操作，Fragment的状态切换时操作的相关问题。<br>所以，为了保持良好的用户体验，我们应该在页面处于可见状态时再去初始化和加载数据。<br><strong>解决方法</strong>：封装Fragment懒加载</li>
</ul>
<h2 id="Fragment-懒加载"><a href="#Fragment-懒加载" class="headerlink" title="Fragment 懒加载"></a>Fragment 懒加载</h2><p>懒加载指的是当有需要的时候才去加载。我们可以重写Fragment的setUserVisibleHint()。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseLazyFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String TAG = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第一次可见状态，第一次不可见状态</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isFirstVisible = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isFirstInVisible = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isPrepared;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        TAG = <span class="keyword">this</span>.getClass().getSimpleName();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (getContentViewLayoutID() != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> inflater.inflate(getContentViewLayoutID(), <span class="keyword">null</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.onCreateView(inflater, container, savedInstanceState);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewCreated</span><span class="params">(View view, @Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onViewCreated(view, savedInstanceState);</span><br><span class="line">        initView(view);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityCreated</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onActivityCreated(savedInstanceState);</span><br><span class="line">        initPrepared();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">initPrepared</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(isPrepared)&#123;</span><br><span class="line">            onFirstUserVisible();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            isPrepared = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//可见状态，不可见状态</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserVisibleHint</span><span class="params">(<span class="keyword">boolean</span> isVisibleToUser)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setUserVisibleHint(isVisibleToUser);</span><br><span class="line">        <span class="keyword">if</span>(isVisibleToUser)&#123;</span><br><span class="line">            <span class="keyword">if</span>(isFirstVisible)&#123;</span><br><span class="line">                isFirstVisible = <span class="keyword">false</span>;</span><br><span class="line">                initPrepared();</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                onUserVisible();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (isFirstInVisible)&#123;</span><br><span class="line">                isFirstInVisible = <span class="keyword">false</span>;</span><br><span class="line">                onFirstUserInVisible();</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                onUserInVisible();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        destroyViewAndThing();</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">getContentViewLayoutID</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">(View view)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//建议在此函数内初始化view或请求数据（only once的那种）</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onFirstUserVisible</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onFirstUserInVisible</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//相当于onResume()</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onUserVisible</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onUserInVisible</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">destroyViewAndThing</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>当然在这个基类中我们还可以封装一些通用的方法，比如页面跳转，吐司…</p>
<p>ps：不排除存在我们需要在界面不可见的时候去请求数据的需求，所以还是具体业务具体分析，然后再选择最合适的解决方案。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/18/从源码解析Android异步消息处理机制（三）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Forwards">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forwards">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/18/从源码解析Android异步消息处理机制（三）/" itemprop="url">从源码解析Android异步消息处理机制（三）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-18T21:06:46+08:00">
                2017-07-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="从源码解析Android异步消息处理机制（三）"><a href="#从源码解析Android异步消息处理机制（三）" class="headerlink" title="从源码解析Android异步消息处理机制（三）"></a>从源码解析Android异步消息处理机制（三）</h1><hr>
<p><strong>前言：本篇纯属个人学习笔记，故摘录《Android开发艺术探索》大量语句，特此声明</strong></p>
<hr>
<ul>
<li>目的：本篇主要学习主线程中的消息循环以及Handler、HandlerThread和Thread的相区别。<br><em><a href="https://ucoon.github.io/2017/07/13/%E4%BB%8E%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90Android%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6%EF%BC%88%E4%B8%80%EF%BC%89/" target="_blank" rel="noopener">MessageQueue以及Looper的相关知识请见此系列的第一篇</a></em><br><em><a href="https://ucoon.github.io/2017/07/17/%E4%BB%8E%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90Android%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6%EF%BC%88%E4%BA%8C%EF%BC%89/" target="_blank" rel="noopener">Handler的相关知识请见此系列的第二篇</a></em><br>主线程中的消息循环</li>
</ul>
<hr>
<p>问题：主线程默认可以使用Handler的原因？<br>Android的主线程是ActivityThread（Android.app.ActivityThread类），我们可以看它的main方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SamplingProfilerIntegration.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// CloseGuard defaults to true and can be quite spammy.  We</span></span><br><span class="line">        <span class="comment">// disable it here, but selectively enable it later (via</span></span><br><span class="line">        <span class="comment">// StrictMode) on debug builds, but using DropBox, not logs.</span></span><br><span class="line">        CloseGuard.setEnabled(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        Environment.initForCurrentUser();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Set the reporter for event logging in libcore</span></span><br><span class="line">        EventLogger.setReporter(<span class="keyword">new</span> EventLoggingReporter());</span><br><span class="line"></span><br><span class="line">        Security.addProvider(<span class="keyword">new</span> AndroidKeyStoreProvider());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Make sure TrustedCertificateStore looks in the right place for CA certificates</span></span><br><span class="line">        <span class="keyword">final</span> File configDir = Environment.getUserConfigDirectory(UserHandle.myUserId());</span><br><span class="line">        TrustedCertificateStore.setDefaultUserDirectory(configDir);</span><br><span class="line"></span><br><span class="line">        Process.setArgV0(<span class="string">"&lt;pre-initialized&gt;"</span>);</span><br><span class="line"></span><br><span class="line">        Looper.prepareMainLooper();</span><br><span class="line"></span><br><span class="line">        ActivityThread thread = <span class="keyword">new</span> ActivityThread();</span><br><span class="line">        thread.attach(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (sMainThreadHandler == <span class="keyword">null</span>) &#123;</span><br><span class="line">            sMainThreadHandler = thread.getHandler();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">false</span>) &#123;</span><br><span class="line">            Looper.myLooper().setMessageLogging(<span class="keyword">new</span></span><br><span class="line">                    LogPrinter(Log.DEBUG, <span class="string">"ActivityThread"</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Looper.loop();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Main thread loop unexpectedly exited"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Initialize the current thread as a looper, marking it as an</span></span><br><span class="line"><span class="comment">     * application's main looper. The main looper for your application</span></span><br><span class="line"><span class="comment">     * is created by the Android environment, so you should never need</span></span><br><span class="line"><span class="comment">     * to call this function yourself.  See also: &#123;<span class="doctag">@link</span> #prepare()&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepareMainLooper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        prepare(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">synchronized</span> (Looper.class) &#123;</span><br><span class="line">            <span class="keyword">if</span> (sMainLooper != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"The main Looper has already been prepared."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            sMainLooper = myLooper();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(<span class="keyword">boolean</span> quitAllowed)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (sThreadLocal.get() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Only one Looper may be created per thread"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    sThreadLocal.set(<span class="keyword">new</span> Looper(quitAllowed));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在main方法中通过Looper.prepareMainLooper()来创建主线程的Looper以及MessageQueue，并通过Looper.loop()来开启主线程的消息循环。当然ActivityThread还需要一个Handler来和消息队列进行交换，从源码我们看出sMainThreadHandler就是ActivityThread.H，它内部定义了一组消息类型，主要包含了四大组件的启动和停止等过程。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LAUNCH_ACTIVITY         = <span class="number">100</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PAUSE_ACTIVITY          = <span class="number">101</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PAUSE_ACTIVITY_FINISHING= <span class="number">102</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STOP_ACTIVITY_SHOW      = <span class="number">103</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STOP_ACTIVITY_HIDE      = <span class="number">104</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SHOW_WINDOW             = <span class="number">105</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> HIDE_WINDOW             = <span class="number">106</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RESUME_ACTIVITY         = <span class="number">107</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SEND_RESULT             = <span class="number">108</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DESTROY_ACTIVITY        = <span class="number">109</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BIND_APPLICATION        = <span class="number">110</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> EXIT_APPLICATION        = <span class="number">111</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NEW_INTENT              = <span class="number">112</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RECEIVER                = <span class="number">113</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CREATE_SERVICE          = <span class="number">114</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SERVICE_ARGS            = <span class="number">115</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STOP_SERVICE            = <span class="number">116</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (DEBUG_MESSAGES) Slog.v(TAG, <span class="string">"&gt;&gt;&gt; handling: "</span> + msg.what);</span><br><span class="line">          <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">           ...</span><br><span class="line">		<span class="keyword">case</span> EXIT_APPLICATION:</span><br><span class="line">                   <span class="keyword">if</span> (mInitialApplication != <span class="keyword">null</span>) &#123;</span><br><span class="line">                       mInitialApplication.onTerminate();</span><br><span class="line">                   &#125;</span><br><span class="line">                   Looper.myLooper().quit();</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">				...</span><br><span class="line">			&#125;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">scheduleExit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          queueOrSendMessage(H.EXIT_APPLICATION, <span class="keyword">null</span>);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure></p>
<p>而在学习Looper.loop()时，我们提过，只有调用了Looper.quit()，loop()才会跳出循环，对于主程序的消息循环，我一直没有找到源码是在哪里调用了scheduleExit()（如果读者知道，恳请赐教…）<br>对于主线程的消息循环还涉及了ApplicationThread和AMS的相关知识，由于笔者学的尚浅，所以此处留空以待学完再来补充……</p>
<p><strong>HandlerThread</strong></p>
<p>我们知道在子线程之间通信可以使用Handler+Thread来完成（需操作Looper：调用Looper.prepare()和Looper.loop()），对于这个需求Google官方已经封装了一个类——HandlerThread<br>HandlerThread的源码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mPriority;</span><br><span class="line">    <span class="keyword">int</span> mTid = -<span class="number">1</span>;</span><br><span class="line">    Looper mLooper;</span><br><span class="line">    </span><br><span class="line">	...</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mTid = Process.myTid();</span><br><span class="line">        Looper.prepare();</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            mLooper = Looper.myLooper();</span><br><span class="line">            notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">        Process.setThreadPriority(mPriority);</span><br><span class="line">        onLooperPrepared();</span><br><span class="line">        Looper.loop();</span><br><span class="line">        mTid = -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到HandlerThread继承了Thread，它是一种可以使用Handler的Thread，它在run方法中通过Looper.prepare()来创建消息队列，并通过Looper.loop来开启消息循环。它和普通线程的区别就是多了一个Looper，这是子线程特有的Looper，用来做消息的取出和处理。由于HandlerThread的run方法是个死循环，因此当不需要使用HandlerThread时，可以通过它的quit()或quitSafely()来终止线程的执行。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">quit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       Looper looper = getLooper();</span><br><span class="line">       <span class="keyword">if</span> (looper != <span class="keyword">null</span>) &#123;</span><br><span class="line">           looper.quit();</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">quitSafely</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       Looper looper = getLooper();</span><br><span class="line">       <span class="keyword">if</span> (looper != <span class="keyword">null</span>) &#123;</span><br><span class="line">           looper.quitSafely();</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>最后撸一个示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> HandlerThread mHandlerThread;</span><br><span class="line">......</span><br><span class="line">mHandlerThread = <span class="keyword">new</span> HandlerThread(<span class="string">"HandlerThread"</span>);</span><br><span class="line">handlerThread.start();</span><br><span class="line"><span class="comment">//创建Handler，使用mHandlerThread.getLooper()生成Looper</span></span><br><span class="line"><span class="keyword">final</span> Handler handler = <span class="keyword">new</span> Handler(mHandlerThread.getLooper())&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"收到消息"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"><span class="comment">//然后再新建一个子线程来发送消息</span></span><br><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);<span class="comment">//模拟耗时操作</span></span><br><span class="line">                    handler.sendEmptyMessage(<span class="number">0</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"><span class="comment">//最后一定不要忘了在onDestroy释放,避免内存泄漏</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        mHandlerThread.quit();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/17/从源码解析Android异步消息处理机制（二）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Forwards">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Forwards">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/17/从源码解析Android异步消息处理机制（二）/" itemprop="url">从源码解析Android异步消息处理机制（二）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-17T23:29:33+08:00">
                2017-07-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="从源码解析Android异步消息处理机制（二）"><a href="#从源码解析Android异步消息处理机制（二）" class="headerlink" title="从源码解析Android异步消息处理机制（二）"></a>从源码解析Android异步消息处理机制（二）</h1><hr>
<p><strong>前言：本篇纯属个人学习笔记，故摘录《Android开发艺术探索》大量语句，特此声明</strong></p>
<hr>
<ul>
<li>目的：深入理解Looper、Handler、MessageQueue三者之间的关系。<br><em><a href="https://ucoon.github.io/2017/07/13/%E4%BB%8E%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90Android%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6%EF%BC%88%E4%B8%80%EF%BC%89/" target="_blank" rel="noopener">MessageQueue以及Looper的相关知识请见此系列的第一篇</a></em><br>Handler</li>
</ul>
<hr>
<p>Handler是Android消息机制的上层接口，对于Handler的使用我们是熟悉的，我们往往认为Handler的作用仅仅是更新UI，但其实这只是Handler的一个特殊的使用场景。Handler的主要作用是将一个任务切换到某个指定的线程中去执行。<br>当然我们常用Handler来更新UI是有原因的：这是因为Android规定访问UI只能在主线程（UI线程）中进行，如果在子线程中访问UI，那么程序会抛出异常。ViewRootImpl（Android.View.ViewRootImpl）.checkThread()方法对UI操作做了验证<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">checkThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(mThread != Thread.currentThread()) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> CalledFromWrongThreadException(</span><br><span class="line">					<span class="string">"Only the original thread that created a view hierarchy can touch its views."</span>);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>因此必须在主线程中访问UI，但又不能在主线程中进行耗时操作，否则会导致ANR（程序无响应）。这时候就是Handler起作用的时候了。</p>
<p>延伸：系统为什么不允许在子线程中访问UI？这是因为Android的UI控件不是<a href="https://ucoon.github.io/2017/05/21/%E3%80%8AJava%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E8%B7%B5%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/" target="_blank" rel="noopener">线程安全的</a>。</p>
<blockquote>
<p>当多个线程访问一个类时，若不用考虑这些线程在运行时环境下的调整和交替执行，并且不需要额外的同步及在调用方代码不必做其他的协调，这个类的行为仍然是正确的，那么称这个类是线程安全的。</p>
</blockquote>
<p>所以在多线程中并发访问可能会导致UI控件处于不可预期的状态。对于多线程操作我们可以使用锁机制，但是系统不对UI控件的访问加上锁机制是有原因的：①会增加逻辑的复杂性；②会降低UI访问的效率，因为锁机制会阻塞某些线程的执行。<br>首先我们看看Handler的默认构造方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Callback callback, <span class="keyword">boolean</span> async)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (FIND_POTENTIAL_LEAKS) &#123;</span><br><span class="line">        <span class="keyword">final</span> Class&lt;? extends Handler&gt; klass = getClass();</span><br><span class="line">        <span class="keyword">if</span> ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;&amp;</span><br><span class="line">                (klass.getModifiers() &amp; Modifier.STATIC) == <span class="number">0</span>) &#123;</span><br><span class="line">            Log.w(TAG, <span class="string">"The following Handler class should be static or leaks might occur: "</span> +</span><br><span class="line">                klass.getCanonicalName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mLooper = Looper.myLooper();</span><br><span class="line">    <span class="keyword">if</span> (mLooper == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">            <span class="string">"Can't create handler inside thread that has not called Looper.prepare()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    mQueue = mLooper.mQueue;</span><br><span class="line">    mCallback = callback;</span><br><span class="line">    mAsynchronous = async;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>从上面我们可以看出如果当前线程没有Looper的话，就会抛出异常，这也就解释了在没有Looper的子线程中创建Handler会引发程序异常的原因了。紧接着又获取mLooper实例中保存的mQueue，这样Handler就与MessageQueue关联上了。<br>接下来我们啃一下我们最常用的方法——sengMessage(msg)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">sendMessage</span><span class="params">(Message msg)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sendMessageDelayed(msg, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">sendMessageDelayed</span><span class="params">(Message msg, <span class="keyword">long</span> delayMillis)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (delayMillis &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            delayMillis = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sendMessageAtTime(msg, SystemClock.uptimeMillis() + delayMillis);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendMessageAtTime</span><span class="params">(Message msg, <span class="keyword">long</span> uptimeMillis)</span> </span>&#123;</span><br><span class="line">        MessageQueue queue = mQueue;</span><br><span class="line">        <span class="keyword">if</span> (queue == <span class="keyword">null</span>) &#123;</span><br><span class="line">            RuntimeException e = <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                    <span class="keyword">this</span> + <span class="string">" sendMessageAtTime() called with no mQueue"</span>);</span><br><span class="line">            Log.w(<span class="string">"Looper"</span>, e.getMessage(), e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> enqueueMessage(queue, msg, uptimeMillis);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">enqueueMessage</span><span class="params">(MessageQueue queue, Message msg, <span class="keyword">long</span> uptimeMillis)</span> </span>&#123;</span><br><span class="line">        msg.target = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">if</span> (mAsynchronous) &#123;</span><br><span class="line">            msg.setAsynchronous(<span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> queue.enqueueMessage(msg, uptimeMillis);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>辗转反侧到了enqueueMessage()方法中，首先为msg.target赋值为this，而在Looper的loop方法会取出每个msg，并交给msg.target.dispatchMessage(msg)去处理消息，也就是将当前的handler作为msg的target属性。最终调用queue的enqueueMessage的方法。简而言之，Handler发送消息的过程仅仅是向消息队列中插入一条消息。而消息由Looper交由Handler处理（dispatchMessage()）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispatchMessage</span><span class="params">(Message msg)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">if</span> (msg.callback != <span class="keyword">null</span>) &#123;  </span><br><span class="line">            handleCallback(msg);  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            <span class="keyword">if</span> (mCallback != <span class="keyword">null</span>) &#123;  </span><br><span class="line">                <span class="keyword">if</span> (mCallback.handleMessage(msg)) &#123;  </span><br><span class="line">                    <span class="keyword">return</span>;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">            handleMessage(msg);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Subclasses must implement this to receive messages.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>handler处理消息的流程如下：<br>首先检查Message的callback是否为null， 不为null就通过handleCallback(msg)来处理消息。handleCallback()实现如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">handleCallback</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">        message.callback.run();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>message的callback是一个Runnable对象，实际上就是Handler的post传递的Runnable参数。其次检查mCallback是否为null，不为null就调用mCallback的handleMessage()方法。<br>mCallback是一个接口：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Callback interface you can use when instantiating a Handler to avoid</span></span><br><span class="line"><span class="comment">     * having to implement your own subclass of Handler.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg A &#123;<span class="doctag">@link</span> android.os.Message Message&#125; object</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> True if no further handling is desired</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Callback</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span></span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>最后还是调到handleMessage()方法。这就给我们提供了另一种方式来创建Handler对象，就如源码中的注释。<br>handleMessage()是一个空方法，消息的最终回调是由我们控制的，我们在创建Handler的时候都是复写handlerMessage方法，然后根据msg.what去处理消息的。</p>
<p>当然，在使用Handler时，应注意内存泄漏问题，相关解决办法可自行google。</p>
<p><strong>小结</strong></p>
<ol>
<li>Handler的构造方法会获取当前线程中保存的Looper实例，进而与Looper实例中的MessageQueue关联上。</li>
<li>Handler的sendMessage()会将当前的handler作为msg的target属性。最终调用queue的enqueueMessage的方法。简而言之，Handler发送消息的过程仅仅是向消息队列中插入一条消息。而消息由Looper交由Handler处理（dispatchMessage()）。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Forwards</p>
              <p class="site-description motion-element" itemprop="description">Keep coding</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Ucoon" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.jianshu.com/u/0b3edec737da" target="_blank" title="简书">
                      
                        <i class="fa fa-fw fa-globe"></i>简书</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Forwards</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
